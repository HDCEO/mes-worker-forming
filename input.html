<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MES ì‘ì—…ì ì…ë ¥ - í¬ë°ë°˜</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { background: #1e3a8a; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #2563eb; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        .hidden { display: none !important; }
        .work-item { padding: 15px; margin: 10px 0; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer; }
        .work-item:hover { border-color: #3b82f6; }
        .work-item.selected { border-color: #3b82f6; background: #dbeafe; }
        select, input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
        .kpi-item { text-align: center; padding: 15px; background: #f9fafb; border-radius: 6px; }
        .kpi-value { font-size: 24px; font-weight: bold; color: #1e3a8a; }
        .defect-list { margin-top: 10px; padding: 10px; background: #f9fafb; border-radius: 6px; }
        .defect-item { padding: 5px; border-bottom: 1px solid #e5e7eb; }
        
        /* ì‘ì—… ê°€ì´ë“œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .work-guide-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .work-guide-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 16px;
            font-weight: 600;
        }
        
        .guide-main {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .guide-icon {
            font-size: 20px;
        }
        
        .recommended-work {
            color: #1e40af;
            font-weight: bold;
        }
        
        .delivery-countdown {
            background: #fef3c7;
            color: #92400e;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .delivery-countdown.urgent {
            background: #fee2e2;
            color: #991b1b;
            animation: urgentPulse 2s infinite;
        }
        
        @keyframes urgentPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ì‘ì—… ëª©ë¡ ìš°ì„ ìˆœìœ„ ìŠ¤íƒ€ì¼ ê°œì„  */
        .work-item {
            position: relative;
            padding: 15px;
            margin: 10px 0;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .work-item:hover {
            border-color: #3b82f6;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .work-item.selected {
            border-color: #3b82f6 !important;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            animation: selectedPulse 2s infinite;
            position: relative;
            z-index: 10;
        }
        
        @keyframes selectedPulse {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            }
            50% { 
                box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);
            }
        }
        
        .work-item.selected::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8, #3b82f6);
            border-radius: 12px;
            z-index: -1;
            animation: borderGlow 2s linear infinite;
        }
        
        @keyframes borderGlow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .selected-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            background: #3b82f6;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
            animation: checkboxPop 0.3s ease-out;
        }
        
        @keyframes checkboxPop {
            0% { 
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
            50% { 
                transform: scale(1.2) rotate(90deg);
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .selected-label {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: #3b82f6;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            animation: labelSlideDown 0.4s ease-out;
        }
        
        @keyframes labelSlideDown {
            0% { 
                transform: translateX(-50%) translateY(-10px);
                opacity: 0;
            }
            100% { 
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .work-item.urgent {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 6px solid #ef4444;
        }
        
        .work-item.priority {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 6px solid #f59e0b;
        }
        
        .work-item.normal {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 6px solid #10b981;
        }
        
        .work-item.low {
            border-color: #6b7280;
            background: #f9fafb;
            opacity: 0.8;
        }
        
        .work-order-badge {
            position: absolute;
            top: -8px;
            left: 15px;
            background: #1e40af;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .work-order-badge.first {
            background: #ef4444;
            animation: recommendedWork 2s infinite;
        }
        
        .work-order-badge.second {
            background: #f59e0b;
        }
        
        .work-order-badge.third {
            background: #10b981;
        }
        
        @keyframes recommendedWork {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .work-priority-icons {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .priority-icon {
            font-size: 16px;
        }
        
        .delivery-info {
            background: rgba(255,255,255,0.8);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #374151;
            margin-top: 5px;
        }
        
        .delivery-info.urgent {
            background: #fee2e2;
            color: #991b1b;
            font-weight: bold;
        }
        
        .delivery-info.today {
            background: #fef3c7;
            color: #92400e;
            font-weight: bold;
        }
        
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .notification-list {
            margin-top: 8px;
            padding: 8px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
            border-left: 3px solid #3b82f6;
        }
        
        .notification-item {
            font-size: 11px;
            color: #1e40af;
            margin-bottom: 2px;
        }
        
        .notification-item:last-child {
            margin-bottom: 0;
        }
        
        /* ì‹¤ì‹œê°„ ì•Œë¦¼ í† ìŠ¤íŠ¸ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            max-width: 350px;
        }
        
        .toast {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 10px;
            transform: translateX(100%);
            animation: slideIn 0.3s ease-out forwards;
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.warning {
            border-left: 4px solid #f59e0b;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .toast.info {
            border-left: 4px solid #3b82f6;
        }
        
        @keyframes slideIn {
            to {
                transform: translateX(0);
            }
        }
        
        @keyframes slideOut {
            to {
                transform: translateX(100%);
            }
        }
        
        .toast-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .toast-icon {
            font-size: 16px;
        }
        
        /* ê°œì„ ëœ ë¶ˆëŸ‰ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .defect-alert-section {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .defect-alert-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .defect-alert-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #991b1b;
            font-weight: 600;
        }
        
        .emergency-defect-btn {
            background: #ef4444;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
            animation: defectPulse 2s infinite;
        }
        
        .emergency-defect-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(239, 68, 68, 0.4);
        }
        
        @keyframes defectPulse {
            0%, 100% { box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 4px 8px rgba(239, 68, 68, 0.6); }
        }
        
        .defect-analysis-modal .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .work-context-section {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .work-context-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .context-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0f2fe;
        }
        
        .context-label {
            font-weight: 600;
            color: #0c4a6e;
        }
        
        .context-value {
            color: #374151;
            font-weight: 500;
        }
        
        .defect-analysis-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .analysis-step {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            background: #f9fafb;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .step-number {
            background: #3b82f6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .step-title {
            font-weight: 600;
            color: #374151;
        }
        
        .analysis-step.completed .step-number {
            background: #10b981;
        }
        
        .analysis-step.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .defect-type-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .defect-type-btn {
            padding: 12px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 14px;
        }
        
        .defect-type-btn:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .defect-type-btn.selected {
            border-color: #3b82f6;
            background: #dbeafe;
            font-weight: 600;
        }
        
        .cause-analysis-tree {
            margin-top: 15px;
        }
        
        .cause-category {
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .cause-header {
            background: #f3f4f6;
            padding: 12px 15px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cause-list {
            padding: 10px;
            background: white;
            display: none;
        }
        
        .cause-list.active {
            display: block;
        }
        
        .cause-item {
            padding: 8px 12px;
            margin: 4px 0;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .cause-item:hover {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        
        .cause-item.selected {
            border-color: #f59e0b;
            background: #fef3c7;
            font-weight: 600;
        }
        
        .action-plan-section {
            background: #f0fdf4;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .action-grid {
            display: grid;
            gap: 15px;
            margin-top: 10px;
        }
        
        .defect-history-section {
            background: #fefce8;
            border: 1px solid #eab308;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .history-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .history-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .history-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .history-badge.resolved {
            background: #d1fae5;
            color: #065f46;
        }
        
        .defect-impact-alert {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .impact-level {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .impact-level.high {
            color: #ef4444;
        }
        
        .impact-level.medium {
            color: #f59e0b;
        }
        
        .impact-level.low {
            color: #10b981;
        }
        .safety-status-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .safety-status-content {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
        }
        
        .safety-status-content .safety-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .safety-days {
            padding: 4px 12px;
            border-radius: 20px;
            margin: 0 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        /* ì•ˆì „ ì¼ìˆ˜ë³„ ìƒ‰ìƒ */
        .safety-days.level-1 { background: #f3f4f6; color: #6b7280; } /* 30ì¼ ë¯¸ë§Œ - íšŒìƒ‰ */
        .safety-days.level-2 { background: #fef3c7; color: #92400e; } /* 30-99ì¼ - ì£¼í™© */
        .safety-days.level-3 { background: #d1fae5; color: #065f46; } /* 100-199ì¼ - ì´ˆë¡ */
        .safety-days.level-4 { background: #dbeafe; color: #1e40af; } /* 200ì¼+ - íŒŒë‘ */
        
        .safety-divider {
            color: #6b7280;
            margin: 0 8px;
        }
        
        .safety-average, .safety-record {
            font-size: 16px;
            color: #374151;
        }
        
        /* 2ì¸ ì‘ì—… ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .two-person-work { background: #fef3c7; border-left: 4px solid #f59e0b; }
        .worker-info-container { display: flex; flex-direction: column; gap: 5px; }
        .sub-worker-section { margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 6px; border: 1px solid #0ea5e9; }
        .worker-badge { display: inline-block; padding: 2px 8px; margin: 2px; background: #dbeafe; color: #1e40af; border-radius: 12px; font-size: 12px; }
        .main-worker { background: #dcfce7; color: #166534; }
        .sub-worker { background: #fef3c7; color: #92400e; }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .checkbox-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: #f9fafb;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .checkbox-item:hover {
            background: #f3f4f6;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        /* ì´ˆí’ˆê²€ì‚¬ ìŠ¤íƒ€ì¼ */
        .inspection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .product-inspection {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .product-inspection.completed {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .product-inspection.failed {
            border-color: #ef4444;
            background: #fef2f2;
            animation: failureShake 0.5s ease-in-out;
        }

        @keyframes failureShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .inspection-items {
            margin: 15px 0;
        }

        .inspection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }

        .inspection-label {
            font-weight: 500;
            color: #374151;
        }

        .inspection-buttons {
            display: flex;
            gap: 5px;
        }

        .inspection-btn {
            padding: 4px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inspection-btn.pass {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #10b981;
        }

        .inspection-btn.pass.selected {
            background: #10b981;
            color: white;
        }

        .inspection-btn.fail {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .inspection-btn.fail.selected {
            background: #ef4444;
            color: white;
        }

        .product-criteria {
            font-size: 12px;
            color: #6b7280;
            margin-top: 10px;
            text-align: left;
        }

        .inspection-progress {
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            color: #1e3a8a;
        }

        .inspection-warning {
            background: #fef2f2;
            border: 2px solid #ef4444;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            animation: warningPulse 2s infinite;
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .inspection-failed-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .inspection-failed-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .failed-icon {
            font-size: 48px;
            color: #ef4444;
            margin-bottom: 15px;
        }

        .failed-title {
            font-size: 24px;
            font-weight: bold;
            color: #ef4444;
            margin-bottom: 15px;
        }

        .failed-result {
            background: #fef2f2;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ef4444;
        }

        .failed-actions {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
        }

        .failed-actions h4 {
            color: #374151;
            margin-bottom: 10px;
        }

        .failed-actions ul {
            color: #6b7280;
            padding-left: 20px;
        }

        .failed-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn-retry {
            background: #f59e0b;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-retry:hover {
            background: #d97706;
        }

        .btn-maintenance {
            background: #6b7280;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-maintenance:hover {
            background: #4b5563;
        }

        .retry-count-warning {
            background: #fbbf24;
            color: #92400e;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
        }

        /* ì•ˆì „ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .safety-section {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
        }

        .emergency-button {
            background: #ef4444;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
            animation: emergencyPulse 2s infinite;
        }

        .emergency-button:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(239, 68, 68, 0.4);
        }

        @keyframes emergencyPulse {
            0%, 100% { box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 4px 8px rgba(239, 68, 68, 0.6); }
        }

        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .emergency-item {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 16px;
        }

        .emergency-item:hover {
            background: #ef4444;
            color: white;
            transform: scale(1.05);
        }

        .emergency-item .icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        .safety-checklist-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .safety-checklist-group h4 {
            color: #374151;
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="container">
        <div class="header">
            <h1>í¬ë°ë°˜ ì‘ì—…ì ë¡œê·¸ì¸</h1>
        </div>
        <div class="section">
            <h2>ì‘ì—…ì ì •ë³´ ì…ë ¥</h2>
            <br>
            <label>ì£¼ì‘ì—…ì ì´ë¦„:</label>
            <select id="workerName">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ê¹€ì² ìˆ˜">ê¹€ì² ìˆ˜</option>
                <option value="ì´ì˜í¬">ì´ì˜í¬</option>
                <option value="ë°•ë¯¼ìˆ˜">ë°•ë¯¼ìˆ˜</option>
                <option value="ê¹€ìˆ˜ì •">ê¹€ìˆ˜ì •</option>
                <option value="ì´ì² ìˆ˜">ì´ì² ìˆ˜</option>
                <option value="ë°•ì˜í¬">ë°•ì˜í¬</option>
                <option value="ìµœë¯¼í˜¸">ìµœë¯¼í˜¸</option>
                <option value="ì •ëŒ€í˜„">ì •ëŒ€í˜„</option>
                <option value="ê°•ë¯¸ì˜">ê°•ë¯¸ì˜</option>
                <option value="í™ê¸¸ë™">í™ê¸¸ë™</option>
            </select>
            
            <br><br>
            <label>ì‘ì—… í˜¸ê¸°:</label>
            <select id="machineNo">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="1">1í˜¸ê¸°</option>
                <option value="2">2í˜¸ê¸°</option>
                <option value="3">3í˜¸ê¸°</option>
            </select>
            
            <!-- 2ì¸ ì‘ì—… ì„¹ì…˜ -->
            <div class="sub-worker-section">
                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" id="twoPersonWork" style="width: auto; margin-right: 10px;" onchange="toggleSubWorker()">
                    <span style="font-weight: bold;">2ì¸ ì‘ì—… (ëŒ€í˜• ì œí’ˆ)</span>
                </label>
                
                <div id="subWorkerSection" style="display: none;">
                    <label>ë³´ì¡°ì‘ì—…ì ì„ íƒ:</label>
                    <div id="subWorkerList" style="max-height: 150px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-top: 5px;">
                        <!-- ë³´ì¡°ì‘ì—…ì ì²´í¬ë°•ìŠ¤ ëª©ë¡ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                    </div>
                    <div id="selectedSubWorkers" style="margin-top: 10px; font-size: 14px; color: #666;">
                        ì„ íƒëœ ë³´ì¡°ì‘ì—…ì: ì—†ìŒ
                    </div>
                </div>
            </div>
            
            <br><br>
            <button class="btn" onclick="doLogin()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen" class="container hidden">
        <div class="header">
            <h1>í¬ë°ë°˜ ì‘ì—… ì…ë ¥</h1>
            <div class="worker-info-container">
                <div id="workerInfo"></div>
                <div id="subWorkerInfo" style="font-size: 14px; color: #e5e7eb;"></div>
            </div>
            <div>í˜„ì¬ ì‹œê°„: <span id="currentTime"></span></div>
            <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn" onclick="logout()" style="padding: 5px 15px; font-size: 14px; background: #6b7280;">ë¡œê·¸ì•„ì›ƒ</button>
                <button class="emergency-button" onclick="showEmergencyModal()">ğŸš¨ ê¸´ê¸‰ìƒí™©</button>
            </div>
        </div>
        
        <!-- ì•ˆì „ í˜„í™© ì„¹ì…˜ -->
        <div class="safety-status-section">
            <div class="safety-status-content">
                <span class="safety-icon">ğŸ›¡ï¸</span>
                <span>ì•ˆì „ í˜„í™©:</span>
                <span class="safety-days" id="currentLineSafety">3í˜¸ê¸° 127ì¼ ë¬´ì‚¬ê³ </span>
                <span class="safety-divider">|</span>
                <span class="safety-average">ì „ì²´ í‰ê·  <span id="averageSafety">98</span>ì¼</span>
                <span class="safety-divider">|</span>
                <span class="safety-record">ìµœê³ ê¸°ë¡ <span id="recordSafety">245</span>ì¼</span>
            </div>
        </div>
        
        <!-- ë¶ˆëŸ‰ ë°œìƒ ì•Œë¦¼ ì„¹ì…˜ (ì‘ì—… ì¤‘ì—ë§Œ í‘œì‹œ) -->
        <div class="defect-alert-section" id="defectAlertSection">
            <div class="defect-alert-content">
                <div class="defect-alert-info">
                    <span style="font-size: 20px;">ğŸš¨</span>
                    <span>ë¶ˆëŸ‰ ë°œê²¬ ì‹œ ì¦‰ì‹œ ì‹ ê³ í•˜ì„¸ìš”!</span>
                </div>
                <button class="emergency-defect-btn" onclick="showDefectAnalysisModal()">
                    ğŸš¨ ê¸´ê¸‰ ë¶ˆëŸ‰ ì‹ ê³ 
                </button>
            </div>
        </div>
        <div class="work-guide-section">
            <div class="work-guide-content">
                <div class="guide-main">
                    <span class="guide-icon">ğŸ“</span>
                    <span>ë‹¤ìŒ ê¶Œì¥ ì‘ì—…:</span>
                    <span class="recommended-work" id="recommendedWork">ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”</span>
                </div>
                <div class="delivery-countdown" id="deliveryCountdown">-</div>
            </div>
        </div>
        
        <!-- KPI ì„¹ì…˜ -->
        <div class="section">
            <h2>ì‹¤ì‹œê°„ í˜„í™©</h2>
            <div class="kpi-grid">
                <div class="kpi-item">
                    <div>ì´ ìƒì‚°ëŸ‰</div>
                    <div class="kpi-value" id="totalProduction">0m</div>
                </div>
                <div class="kpi-item">
                    <div>ë‹¬ì„±ë¥ </div>
                    <div class="kpi-value" id="achievementRate">0%</div>
                </div>
                <div class="kpi-item">
                    <div>ë¶ˆëŸ‰ë¥ </div>
                    <div class="kpi-value" id="defectRate">0%</div>
                </div>
                <div class="kpi-item">
                    <div>ì‘ì—… ì‹œê°„</div>
                    <div class="kpi-value" id="workTime">00:00</div>
                </div>
            </div>
        </div>
        
        <!-- ì‘ì—… ì œì–´ -->
        <div class="section">
            <h2>ì‘ì—… ì œì–´</h2>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <button class="btn btn-success" id="startBtn" onclick="startWork()" disabled>â–¶ï¸ ì‘ì—… ì‹œì‘</button>
                <button class="btn btn-danger" id="stopBtn" onclick="showStopModal()" disabled>â¸ï¸ ì„¤ë¹„ ì •ì§€</button>
                <button class="btn btn-warning" id="pauseBtn" onclick="showPauseWorkModal()" disabled>â¸ï¸ ì‘ì—… ì¤‘ë‹¨</button>
                <button class="btn" id="resumeBtn" onclick="resumeWork()" disabled>â–¶ï¸ ì‘ì—… ì¬ê°œ</button>
                <button class="btn btn-success" id="resumeWorkBtn" onclick="resumePausedWork()" disabled>â–¶ï¸ ì´ì–´ì„œ ì‘ì—…</button>
                <button class="btn" id="endBtn" onclick="showEndWorkModal()" disabled style="background: #6b7280;">â¹ï¸ ì‘ì—… ì¢…ë£Œ</button>
            </div>
            <div id="currentWork" style="margin-top: 10px; font-weight: bold; text-align: center;"></div>
            <div id="previousProduction" style="margin-top: 5px; color: #3b82f6; text-align: center;"></div>
        </div>
        
        <!-- ì‘ì—… ëª©ë¡ -->
        <div class="section">
            <h2>ì‘ì—… ëª©ë¡ <span style="font-size: 14px; color: #666;">(ìŠ¤ë§ˆíŠ¸ ì •ë ¬ ì ìš©)</span></h2>
            <div id="workList"></div>
        </div>
        
        <!-- ì‹¤ì‹œê°„ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
        <div class="toast-container" id="toastContainer"></div>
        
        <!-- ë¶ˆëŸ‰ ê¸°ë¡ -->
        <div class="section">
            <h2>ë¶ˆëŸ‰ ê´€ë¦¬ <span style="font-size: 14px; color: #666;">(ê³ ë„í™”ëœ ì¶”ì  ì‹œìŠ¤í…œ)</span></h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label>ë¶ˆëŸ‰ ìˆ˜ëŸ‰ (m):</label>
                    <input type="number" id="defectQty" placeholder="0" step="0.1">
                    <label>ë¶ˆëŸ‰ ìœ í˜•:</label>
                    <select id="defectType">
                        <option value="">ì„ íƒ</option>
                        <option value="surface">í‘œë©´ë¶ˆëŸ‰</option>
                        <option value="dimension">ì¹˜ìˆ˜ë¶ˆëŸ‰</option>
                        <option value="deformation">ë³€í˜•</option>
                        <option value="foreign">ì´ë¬¼ì§ˆ</option>
                        <option value="other">ê¸°íƒ€</option>
                    </select>
                    <br><br>
                    <button class="btn" onclick="saveDefect()">ì¼ë°˜ ë¶ˆëŸ‰ ì €ì¥</button>
                    <button class="btn" onclick="showDefectAnalysisModal()" style="background: #ef4444; margin-left: 10px;">ğŸ” ìƒì„¸ ë¶„ì„</button>
                </div>
                
                <div style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px; color: #374151;">ğŸ’¡ ë¶ˆëŸ‰ ê´€ë¦¬ ê°€ì´ë“œ</h4>
                    <ul style="font-size: 13px; color: #6b7280; line-height: 1.6;">
                        <li><strong>ì¼ë°˜ ë¶ˆëŸ‰</strong>: ë‹¨ìˆœ ê¸°ë¡ìš©</li>
                        <li><strong>ìƒì„¸ ë¶„ì„</strong>: ì›ì¸ ì¶”ì  ë° ê°œì„  í•„ìš” ì‹œ</li>
                        <li><strong>ê¸´ê¸‰ ì‹ ê³ </strong>: ì‘ì—… ì¤‘ ì¦‰ì‹œ ëŒ€ì‘ í•„ìš” ì‹œ</li>
                        <li>ì—°ì† ë¶ˆëŸ‰ ë°œìƒ ì‹œ ìë™ ì•Œë¦¼</li>
                    </ul>
                </div>
            </div>
            
            <div class="defect-list">
                <h3>ì˜¤ëŠ˜ì˜ ë¶ˆëŸ‰ ê¸°ë¡ <span id="defectSummary" style="font-size: 14px; color: #666;"></span></h3>
                <div id="defectList">ì•„ì§ ê¸°ë¡ëœ ë¶ˆëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
        
        <!-- ì„¤ë¹„ ì •ì§€ ê´€ë¦¬ (í†µí•©) -->
        <div class="section">
            <h2>ì„¤ë¹„ ì •ì§€ ê´€ë¦¬</h2>
            <button class="btn btn-danger" id="independentStopBtn" onclick="showIndependentStopModal()">â¸ï¸ ì„¤ë¹„ ì •ì§€ ê¸°ë¡</button>
            <button class="btn" id="independentResumeBtn" onclick="independentResume()" disabled>â–¶ï¸ ì„¤ë¹„ ì¬ê°€ë™</button>
            <div id="independentStopStatus" style="margin-top: 10px; color: #ef4444; font-weight: bold;"></div>
            <div id="independentStopTime" style="font-size: 20px; color: #ef4444; font-weight: bold;"></div>
            
            <div class="defect-list">
                <h3>ì„¤ë¹„ ì •ì§€ ê¸°ë¡</h3>
                <div id="stopLogList">ì•„ì§ ì„¤ë¹„ ì •ì§€ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>
    
    <!-- ì‹œì‘ ì ê²€ ëª¨ë‹¬ (í™•ì¥ëœ ë²„ì „) -->
    <div id="checklistModal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ”§ ì‘ì—… ì‹œì‘ ì „ ì¢…í•©ì ê²€</h2>
            <p style="color: #666; font-size: 14px; margin: 10px 0;">
                ì‘ì—…ì§€ì‹œì„œ <strong id="checklistWorkNo"></strong> - ì•ˆì „í•œ ì‘ì—…ì„ ìœ„í•´ ë‹¤ìŒ í•­ëª©ì„ í™•ì¸í•˜ì„¸ìš”.
            </p>
            
            <div class="safety-checklist-group">
                <h4>ğŸ­ ì„¤ë¹„ ê´€ë ¨</h4>
                <label style="display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;">
                    <input type="checkbox" id="check1" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì„¤ë¹„ ì´ìƒ ì—†ìŒ</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;">
                    <input type="checkbox" id="check2" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ê¸ˆí˜• ìƒíƒœ ì •ìƒ</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 0; cursor: pointer;">
                    <input type="checkbox" id="check3" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì›ìì¬(ì½”ì¼) ì¤€ë¹„ ì™„ë£Œ</span>
                </label>
            </div>

            <div class="safety-checklist-group">
                <h4>ğŸ›¡ï¸ ì•ˆì „ ê´€ë ¨</h4>
                <label style="display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;">
                    <input type="checkbox" id="check4" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì•ˆì „ì¥ë¹„ ì°©ìš© (ì•ˆì „ëª¨, ì•ˆì „í™”, ì‘ì—…ë³µ)</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;">
                    <input type="checkbox" id="check7" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì‘ì—…êµ¬ì—­ ì•ˆì „ìƒíƒœ í™•ì¸</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 0; cursor: pointer;">
                    <input type="checkbox" id="check8" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;" id="workSpecificSafety">ì´ ì‘ì—…ì˜ íŠ¹ì • ì•ˆì „ì‚¬í•­ í™•ì¸</span>
                </label>
            </div>

            <div class="safety-checklist-group">
                <h4>ğŸ“‹ ì‘ì—… ê´€ë ¨</h4>
                <label style="display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;">
                    <input type="checkbox" id="check5" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì‘ì—…ì§€ì‹œì„œ í™•ì¸</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 0; cursor: pointer;">
                    <input type="checkbox" id="check6" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì¸ìˆ˜ì¸ê³„ ì‚¬í•­ í™•ì¸</span>
                </label>
            </div>
            
            <br>
            <button class="btn btn-success" id="checklistConfirmBtn" onclick="confirmChecklist()" disabled style="width: 100%; padding: 15px;">ëª¨ë“  í•­ëª© í™•ì¸ ì™„ë£Œ</button>
            <button class="btn" style="background: #6b7280; width: 100%; padding: 10px; margin-top: 10px;" onclick="skipChecklist()">ê±´ë„ˆë›°ê¸°</button>
        </div>
    </div>
    
    <!-- ì´ˆí’ˆê²€ì‚¬ ëª¨ë‹¬ (ê°œì„ ëœ ë²„ì „) -->
    <div id="firstProductModal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ” ì´ˆí’ˆê²€ì‚¬ (í•„ìˆ˜)</h2>
            <p style="color: #666; font-size: 14px; margin: 10px 0;">
                ì‘ì—…ì§€ì‹œì„œ <strong id="inspectionWorkNo"></strong> - <strong id="inspectionProduct"></strong>
            </p>
            <div style="background: #fef3c7; color: #92400e; padding: 10px; border-radius: 4px; margin: 10px 0;">
                âš ï¸ ì²« 3ê°œ ì œí’ˆì„ ê²€ì‚¬í•´ì•¼ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            
            <div id="inspectionWarningArea"></div>
            
            <div class="inspection-progress" id="inspectionProgress">
                ê²€ì‚¬ ì§„í–‰ë¥ : 0/3 ì™„ë£Œ
            </div>
            
            <div class="inspection-grid" id="inspectionGrid">
                <!-- 3ê°œ ì œí’ˆ ê²€ì‚¬ ì¹´ë“œê°€ ì—¬ê¸°ì— ìƒì„±ë¨ -->
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-success" id="completeInspectionBtn" onclick="completeInspection()" disabled>
                    âœ… ê²€ì‚¬ ì™„ë£Œ - ì‘ì—… ì‹œì‘
                </button>
            </div>
        </div>
    </div>

    <!-- ì´ˆí’ˆê²€ì‚¬ ì‹¤íŒ¨ ëª¨ë‹¬ -->
    <div id="inspectionFailedModal" class="inspection-failed-modal hidden">
        <div class="inspection-failed-content">
            <div class="failed-icon">ğŸš«</div>
            <div class="failed-title">ì´ˆí’ˆê²€ì‚¬ ë¶ˆí•©ê²©</div>
            
            <div class="failed-result">
                <div><strong>ê²€ì‚¬ ê²°ê³¼:</strong></div>
                <div id="failedResultText">í•©ê²© 0ê°œ, ë¶ˆí•©ê²© 0ê°œ</div>
            </div>
            
            <div style="background: #fef2f2; color: #991b1b; padding: 15px; border-radius: 8px; margin: 15px 0; font-weight: bold;">
                âš ï¸ í’ˆì§ˆ ê¸°ì¤€ ë¯¸ë‹¬ë¡œ ì¸í•´<br>ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            </div>
            
            <div class="failed-actions">
                <h4>ğŸ“‹ í•„ìš”í•œ ì¡°ì¹˜:</h4>
                <ul>
                    <li>ì„¤ë¹„ ìƒíƒœ ì ê²€</li>
                    <li>ê¸ˆí˜• ì¡°ì •</li>
                    <li>ì›ìì¬ í™•ì¸</li>
                    <li>ì‘ì—… ì¡°ê±´ ì¬ì„¤ì •</li>
                </ul>
            </div>
            
            <div id="retryWarning" class="retry-count-warning hidden">
                âš ï¸ ì¬ê²€ì‚¬ <span id="retryCount">0</span>íšŒ ì‹¤ì‹œë¨ (3íšŒ ì´ˆê³¼ ì‹œ ê´€ë¦¬ì í˜¸ì¶œ)
            </div>
            
            <div class="failed-buttons">
                <button class="btn-retry" onclick="retryInspection()">
                    ğŸ”„ ì¬ê²€ì‚¬ ì‹¤ì‹œ
                </button>
                <button class="btn-maintenance" onclick="requestMaintenance()">
                    ğŸ“ ì„¤ë¹„ì ê²€ ìš”ì²­
                </button>
            </div>
        </div>
    </div>

    <!-- ì„¤ë¹„ ì •ì§€ ëª¨ë‹¬ -->
    <div id="stopModal" class="modal hidden">
        <div class="modal-content">
            <h2>ì„¤ë¹„ ì •ì§€ ì‚¬ìœ </h2>
            <br>
            <label>ì •ì§€ ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
            <select id="stopReason">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="coil_change">ì½”ì¼ì¤€ë¹„êµì²´</option>
                <option value="bending_pack">ë°´ë”©í¬ì¥</option>
                <option value="equipment_failure">ì„¤ë¹„ê³ ì¥</option>
                <option value="mold_change">ê¸ˆí˜•êµì²´</option>
                <option value="material_shortage">ìì¬ë¶€ì¡±</option>
                <option value="maintenance">ì •ê¸°ì ê²€</option>
                <option value="other">ê¸°íƒ€</option>
            </select>
            <br><br>
            <button class="btn btn-danger" onclick="confirmStop()">í™•ì¸</button>
            <button class="btn" onclick="cancelStop()">ì·¨ì†Œ</button>
        </div>
    </div>
    
    <!-- ì‘ì—… ì¢…ë£Œ ëª¨ë‹¬ -->
    <div id="endWorkModal" class="modal hidden">
        <div class="modal-content">
            <h2>ì‘ì—… ì¢…ë£Œ</h2>
            <br>
            <label>ì–‘í’ˆ ìˆ˜ëŸ‰ (m):</label>
            <input type="number" id="goodQty" placeholder="0" step="0.1">
            <br><br>
            <button class="btn btn-success" onclick="confirmEndWork()">í™•ì¸</button>
            <button class="btn" onclick="cancelEndWork()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ì‘ì—… ì¤‘ë‹¨ ëª¨ë‹¬ -->
    <div id="pauseWorkModal" class="modal hidden">
        <div class="modal-content">
            <h2>ì‘ì—… ì¤‘ë‹¨</h2>
            <br>
            <label>í˜„ì¬ê¹Œì§€ ìƒì‚°ëŸ‰ (m):</label>
            <input type="number" id="pauseQty" placeholder="0" step="0.1">
            <br><br>
            <label>ì¤‘ë‹¨ ì‚¬ìœ :</label>
            <select id="pauseReason">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="worker_change">ì‘ì—…ì êµëŒ€</option>
                <option value="urgent_order">ê¸´ê¸‰ ì‘ì—…</option>
                <option value="meal_time">ì‹ì‚¬ ì‹œê°„</option>
                <option value="material_shortage">ìì¬ ë¶€ì¡±</option>
                <option value="quality_issue">í’ˆì§ˆ ë¬¸ì œ</option>
                <option value="other">ê¸°íƒ€</option>
            </select>
            <br><br>
            <label>ì¸ìˆ˜ì¸ê³„ ë©”ëª¨ (ì„ íƒì‚¬í•­):</label>
            <textarea id="pauseMemo" placeholder="ë‹¤ìŒ ì‘ì—…ìì—ê²Œ ì „ë‹¬í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”." 
                      style="height: 80px; resize: vertical;"></textarea>
            <br><br>
            <button class="btn btn-warning" onclick="confirmPauseWork()">í™•ì¸</button>
            <button class="btn" onclick="cancelPauseWork()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ë…ë¦½ ì„¤ë¹„ ì •ì§€ ëª¨ë‹¬ -->
    <div id="independentStopModal" class="modal hidden">
        <div class="modal-content">
            <h2>ì„¤ë¹„ ì •ì§€ ì‚¬ìœ  (ì‘ì—… ì™¸)</h2>
            <br>
            <label>ì •ì§€ ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
            <select id="independentStopReason">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="coil_change">ì½”ì¼ì¤€ë¹„êµì²´</option>
                <option value="bending_pack">ë°´ë”©í¬ì¥</option>
                <option value="equipment_failure">ì„¤ë¹„ê³ ì¥</option>
                <option value="mold_change">ê¸ˆí˜•êµì²´</option>
                <option value="material_shortage">ìì¬ë¶€ì¡±</option>
                <option value="maintenance">ì •ê¸°ì ê²€</option>
                <option value="break">íœ´ì‹ì‹œê°„</option>
                <option value="meeting">íšŒì˜/êµìœ¡</option>
                <option value="other">ê¸°íƒ€</option>
            </select>
            <br><br>
            <button class="btn btn-danger" onclick="confirmIndependentStop()">í™•ì¸</button>
            <button class="btn" onclick="cancelIndependentStop()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ì‹¤ì  ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="correctionModal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ“ ì‹¤ì  ìˆ˜ì •</h2>
            <br>
            <div style="background: #f9fafb; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <div><strong>ì‘ì—…:</strong> <span id="correctionWorkName"></span></div>
                <div><strong>í˜„ì¬ ê¸°ë¡:</strong> <span id="correctionCurrentQty"></span>m</div>
            </div>
            
            <label>ìˆ˜ì •ëŸ‰ (+ ë˜ëŠ” - ì…ë ¥):</label>
            <input type="number" id="correctionAdjustQty" placeholder="ì˜ˆ: +10 ë˜ëŠ” -5" step="0.1">
            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                ì–‘ìˆ˜(+)ëŠ” ì¦ê°€, ìŒìˆ˜(-)ëŠ” ê°ì†Œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
            </div>
            
            <br>
            <label>ìˆ˜ì • ì‚¬ìœ :</label>
            <select id="correctionReason">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ì¸¡ì • ì˜¤ë¥˜">ì¸¡ì • ì˜¤ë¥˜</option>
                <option value="ê³„ì‚° ì‹¤ìˆ˜">ê³„ì‚° ì‹¤ìˆ˜</option>
                <option value="ëˆ„ë½ëœ ìˆ˜ëŸ‰">ëˆ„ë½ëœ ìˆ˜ëŸ‰</option>
                <option value="ì¤‘ë³µ ê¸°ë¡">ì¤‘ë³µ ê¸°ë¡</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
            
            <div id="correctionPreview" style="margin: 15px 0; padding: 10px; background: #e0f2fe; border-radius: 4px; display: none;">
                <strong>ìˆ˜ì • ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°:</strong>
                <div id="correctionPreviewText"></div>
            </div>
            
            <br><br>
            <button class="btn btn-success" onclick="confirmCorrection()">ìˆ˜ì • ì™„ë£Œ</button>
            <button class="btn" onclick="cancelCorrection()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- LOT ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="lotModal" class="modal hidden">
        <div class="modal-content">
            <h2>ì‘ì—… ì‹œì‘ ì •ë³´ ì…ë ¥</h2>
            <p style="color: #666; font-size: 14px; margin: 10px 0;">ì‘ì—…ì— í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <br>
            
            <label>ì½”ì¼ LOT ë²ˆí˜¸:</label>
            <select id="lotSelect" style="width: 100%; padding: 10px; margin: 10px 0;" onchange="handleLotSelect()">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="20250122-HY-001">20250122-HY-001 (í˜„ëŒ€ì œì² )</option>
                <option value="20250122-PO-001">20250122-PO-001 (í¬ìŠ¤ì½”)</option>
                <option value="20250121-HY-003">20250121-HY-003 (í˜„ëŒ€ì œì² )</option>
                <option value="manual">ì§ì ‘ ì…ë ¥...</option>
            </select>
            
            <div id="manualLotInput" style="display: none;">
                <label>LOT ë²ˆí˜¸ ì§ì ‘ ì…ë ¥:</label>
                <input type="text" id="manualLot" placeholder="ì˜ˆ: 20250122-HY-001" style="width: 100%; padding: 10px; margin: 10px 0;">
            </div>
            
            <label style="margin-top: 15px; display: block;">ê¸ˆí˜• ë²ˆí˜¸:</label>
            <select id="moldSelect" style="width: 100%; padding: 10px; margin: 10px 0;" onchange="handleMoldSelect()">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="MBAR-001-4CAV">MBAR-001-4CAV (M-BAR 4ìºë¹„í‹°)</option>
                <option value="MBAR-002-4CAV">MBAR-002-4CAV (M-BAR 4ìºë¹„í‹°)</option>
                <option value="RUN30-001-2CAV">RUN30-001-2CAV (RUNNER 30 2ìºë¹„í‹°)</option>
                <option value="RUN30-002-2CAV">RUN30-002-2CAV (RUNNER 30 2ìºë¹„í‹°)</option>
                <option value="STUD-001-6CAV">STUD-001-6CAV (STUD 6ìºë¹„í‹°)</option>
                <option value="manual">ì§ì ‘ ì…ë ¥...</option>
            </select>
            
            <div id="manualMoldInput" style="display: none;">
                <label>ê¸ˆí˜• ë²ˆí˜¸ ì§ì ‘ ì…ë ¥:</label>
                <input type="text" id="manualMold" placeholder="ì˜ˆ: MBAR-001-4CAV" style="width: 100%; padding: 10px; margin: 10px 0;">
            </div>
            
            <div style="margin: 15px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="sameLotCheck" onclick="handleSameLot()" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ì´ì „ê³¼ ë™ì¼í•œ ì„¤ì • ì‚¬ìš©</span>
                </label>
                <div id="previousInfo" style="font-size: 14px; margin-top: 5px; display: none;">
                    <div id="previousLotInfo" style="color: #3b82f6;"></div>
                    <div id="previousMoldInfo" style="color: #3b82f6;"></div>
                </div>
            </div>
            
            <br>
            <button class="btn btn-success" onclick="confirmLot()">í™•ì¸</button>
            <button class="btn" onclick="cancelLot()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ì¼ì¼ ì•ˆì „ì ê²€ ëª¨ë‹¬ -->
    <div id="dailySafetyModal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ›¡ï¸ ì¼ì¼ ì•ˆì „ì ê²€ (í•„ìˆ˜)</h2>
            <p style="color: #666; font-size: 14px; margin: 10px 0;">
                ì•ˆì „í•œ ì‘ì—…í™˜ê²½ì„ ìœ„í•´ ë‹¤ìŒ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
            </p>
            <div style="background: #fef2f2; color: #991b1b; padding: 10px; border-radius: 4px; margin: 10px 0;">
                âš ï¸ ëª¨ë“  í•­ëª©ì„ í™•ì¸í•´ì•¼ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
            
            <div style="background: #f9fafb; padding: 20px; border-radius: 6px;">
                <label style="display: flex; align-items: center; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="safetyCheck1" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ğŸšª ë¹„ìƒêµ¬ ìœ„ì¹˜ ë° ê²½ë¡œ í™•ì¸</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="safetyCheck2" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ğŸ§¯ ì†Œí™”ê¸° ìœ„ì¹˜ ë° ìƒíƒœ í™•ì¸</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="safetyCheck3" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ğŸ§¹ ì‘ì—…êµ¬ì—­ ì •ë¦¬ì •ëˆ ìƒíƒœ í™•ì¸</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 0; cursor: pointer;">
                    <input type="checkbox" id="safetyCheck4" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="text-align: left;">ğŸ”’ ìœ„í—˜ë¬¼ì§ˆ ë³´ê´€í•¨ ì ê¸ˆ í™•ì¸</span>
                </label>
            </div>
            
            <br>
            <button class="btn btn-success" id="dailySafetyConfirmBtn" onclick="confirmDailySafety()" disabled style="width: 100%; padding: 15px;">
                âœ… ì•ˆì „ì ê²€ ì™„ë£Œ
            </button>
        </div>
    </div>

    <!-- ë¶ˆëŸ‰ ìƒì„¸ ë¶„ì„ ëª¨ë‹¬ -->
    <div id="defectAnalysisModal" class="modal hidden">
        <div class="modal-content defect-analysis-modal">
            <h2>ğŸ” ë¶ˆëŸ‰ ìƒì„¸ ë¶„ì„ ë° ì¶”ì </h2>
            
            <!-- í˜„ì¬ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ -->
            <div class="work-context-section">
                <h3 style="color: #0c4a6e; margin-bottom: 10px;">ğŸ“‹ í˜„ì¬ ì‘ì—… ì •ë³´ (ìë™ ìˆ˜ì§‘)</h3>
                <div class="work-context-grid">
                    <div class="context-item">
                        <span class="context-label">ì‘ì—…ì§€ì‹œì„œ:</span>
                        <span class="context-value" id="contextWorkNo">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">ì œí’ˆëª…:</span>
                        <span class="context-value" id="contextProduct">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">LOT ë²ˆí˜¸:</span>
                        <span class="context-value" id="contextLot">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">ê¸ˆí˜• ë²ˆí˜¸:</span>
                        <span class="context-value" id="contextMold">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">ì‘ì—…ì:</span>
                        <span class="context-value" id="contextWorkers">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">ì‘ì—… ê²½ê³¼:</span>
                        <span class="context-value" id="contextElapsed">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">í˜„ì¬ ì§„í–‰ë¥ :</span>
                        <span class="context-value" id="contextProgress">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">ë°œìƒ ì‹œì :</span>
                        <span class="context-value" id="contextTime">-</span>
                    </div>
                </div>
            </div>
            
            <!-- ë¶ˆëŸ‰ ë¶„ì„ ë‹¨ê³„ -->
            <div class="defect-analysis-steps">
                <!-- 1ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ -->
                <div class="analysis-step active" id="step1">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">ê¸°ë³¸ ë¶ˆëŸ‰ ì •ë³´</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>ë¶ˆëŸ‰ ìˆ˜ëŸ‰ (m):</label>
                            <input type="number" id="analysisDefectQty" placeholder="0" step="0.1" style="width: 100%;">
                        </div>
                        <div>
                            <label>ë°œê²¬ ìœ„ì¹˜:</label>
                            <select id="defectLocation" style="width: 100%;">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="cutting">ì ˆë‹¨ë¶€</option>
                                <option value="bending">ë²¤ë”©ë¶€</option>
                                <option value="surface">í‘œë©´</option>
                                <option value="end">ë‹¨ë¶€</option>
                                <option value="overall">ì „ì²´</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 2ë‹¨ê³„: ë¶ˆëŸ‰ ìœ í˜• -->
                <div class="analysis-step" id="step2">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">ë¶ˆëŸ‰ ìœ í˜• ë¶„ë¥˜</div>
                    </div>
                    <div class="defect-type-grid" id="defectTypeGrid">
                        <div class="defect-type-btn" onclick="selectDefectType('surface')">
                            <strong>í‘œë©´ë¶ˆëŸ‰</strong><br>
                            <small>ê¸í˜, ì°í˜, ì˜¤ì—¼ ë“±</small>
                        </div>
                        <div class="defect-type-btn" onclick="selectDefectType('dimension')">
                            <strong>ì¹˜ìˆ˜ë¶ˆëŸ‰</strong><br>
                            <small>ê¸¸ì´, í­, ë‘ê»˜ ì´ìƒ</small>
                        </div>
                        <div class="defect-type-btn" onclick="selectDefectType('deformation')">
                            <strong>ë³€í˜•ë¶ˆëŸ‰</strong><br>
                            <small>êµ½í˜, ë¹„í‹€ë¦¼, ì£¼ë¦„ ë“±</small>
                        </div>
                        <div class="defect-type-btn" onclick="selectDefectType('foreign')">
                            <strong>ì´ë¬¼ì§ˆ</strong><br>
                            <small>ì² ë¶„, ì˜¤ì¼, ë¨¼ì§€ ë“±</small>
                        </div>
                        <div class="defect-type-btn" onclick="selectDefectType('crack')">
                            <strong>í¬ë™/íŒŒì†</strong><br>
                            <small>ê· ì—´, íŒŒë‹¨, ì°¢ì–´ì§ ë“±</small>
                        </div>
                        <div class="defect-type-btn" onclick="selectDefectType('other')">
                            <strong>ê¸°íƒ€</strong><br>
                            <small>ë¶„ë¥˜ë˜ì§€ ì•ŠëŠ” ë¶ˆëŸ‰</small>
                        </div>
                    </div>
                </div>
                
                <!-- 3ë‹¨ê³„: ì›ì¸ ë¶„ì„ -->
                <div class="analysis-step" id="step3">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">ì›ì¸ ë¶„ì„ (ê·¼ë³¸ì›ì¸ ì¶”ì )</div>
                    </div>
                    <div class="cause-analysis-tree" id="causeTree">
                        <!-- ì›ì¸ ë¶„ì„ íŠ¸ë¦¬ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
                
                <!-- 4ë‹¨ê³„: ê°œì„  ì•¡ì…˜ -->
                <div class="analysis-step" id="step4">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-title">ì¦‰ì‹œ ì¡°ì¹˜ ë° ê°œì„  ì•¡ì…˜</div>
                    </div>
                    <div class="action-plan-section">
                        <div class="action-grid">
                            <div>
                                <label><strong>ì¦‰ì‹œ ì¡°ì¹˜ì‚¬í•­:</strong></label>
                                <textarea id="immediateAction" placeholder="ì§€ê¸ˆ ë‹¹ì¥ í•´ì•¼ í•  ì¡°ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="width: 100%; height: 60px;"></textarea>
                            </div>
                            <div>
                                <label><strong>ì¬ë°œ ë°©ì§€ ê³„íš:</strong></label>
                                <textarea id="preventionPlan" placeholder="ë™ì¼í•œ ë¶ˆëŸ‰ì˜ ì¬ë°œì„ ë§‰ê¸° ìœ„í•œ ê³„íšì„ ì…ë ¥í•˜ì„¸ìš”..." style="width: 100%; height: 60px;"></textarea>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label>ì¡°ì¹˜ ë‹´ë‹¹ì:</label>
                                    <input type="text" id="actionOwner" placeholder="ë‹´ë‹¹ìëª…" style="width: 100%;">
                                </div>
                                <div>
                                    <label>ì™„ë£Œ ì˜ˆì •ì¼:</label>
                                    <input type="date" id="actionDeadline" style="width: 100%;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ê³¼ê±° ìœ ì‚¬ ë¶ˆëŸ‰ ì´ë ¥ -->
            <div class="defect-history-section" id="defectHistorySection" style="display: none;">
                <h4 style="color: #92400e; margin-bottom: 10px;">âš ï¸ ê³¼ê±° ìœ ì‚¬ ë¶ˆëŸ‰ ë°œìƒ ì´ë ¥</h4>
                <div id="similarDefectHistory">
                    <!-- ìœ ì‚¬ ë¶ˆëŸ‰ ì´ë ¥ì´ ë™ì ìœ¼ë¡œ í‘œì‹œë¨ -->
                </div>
            </div>
            
            <!-- ë¶ˆëŸ‰ ì˜í–¥ë„ í‰ê°€ -->
            <div class="defect-impact-alert" id="defectImpactAlert" style="display: none;">
                <div class="impact-level" id="impactLevel">ë†’ìŒ</div>
                <div id="impactMessage">ì´ ë¶ˆëŸ‰ì€ ê³ ê° í´ë ˆì„ ìœ„í—˜ì´ ë†’ìŠµë‹ˆë‹¤. ì¦‰ì‹œ ê´€ë¦¬ìì—ê²Œ ë³´ê³ í•˜ì„¸ìš”.</div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn" onclick="closeDefectAnalysisModal()" style="background: #6b7280;">ì·¨ì†Œ</button>
                <button class="btn" onclick="saveDetailedDefect()" style="background: #ef4444; color: white;">ğŸš¨ ë¶ˆëŸ‰ ë“±ë¡ ë° ì•Œë¦¼</button>
            </div>
        </div>
    </div>
    <div id="emergencyModal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸš¨ ê¸´ê¸‰ìƒí™© ì‹ ê³ </h2>
            <p style="color: #ef4444; font-size: 14px; margin: 10px 0; font-weight: bold;">
                ê¸´ê¸‰ìƒí™©ì„ ì„ íƒí•˜ë©´ ì¦‰ì‹œ ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë©ë‹ˆë‹¤.
            </p>
            
            <div class="emergency-grid">
                <div class="emergency-item" onclick="reportEmergency('fire')">
                    <span class="icon">ğŸ”¥</span>
                    í™”ì¬/ì—°ê¸° ë°œìƒ
                </div>
                <div class="emergency-item" onclick="reportEmergency('accident')">
                    <span class="icon">âš ï¸</span>
                    ì•ˆì „ì‚¬ê³  (ë¶€ìƒ)
                </div>
                <div class="emergency-item" onclick="reportEmergency('gas_leak')">
                    <span class="icon">ğŸ’¨</span>
                    ê°€ìŠ¤/í™”í•™ë¬¼ì§ˆ ëˆ„ì¶œ
                </div>
                <div class="emergency-item" onclick="reportEmergency('power_failure')">
                    <span class="icon">âš¡</span>
                    ì •ì „/ì‹œìŠ¤í…œ ì¥ì• 
                </div>
                <div class="emergency-item" onclick="reportEmergency('earthquake')">
                    <span class="icon">ğŸƒ</span>
                    ì§€ì§„/ìì—°ì¬í•´
                </div>
                <div class="emergency-item" onclick="reportEmergency('other')">
                    <span class="icon">ğŸ“</span>
                    ê¸°íƒ€ ì‘ê¸‰ìƒí™©
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn" onclick="closeEmergencyModal()" style="background: #6b7280;">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // ===== ìƒìˆ˜ ì •ì˜ =====
        const CONFIG = {
            // ì‹œê°„ ê´€ë ¨
            WORK_CORRECTION_TIME_LIMIT_HOURS: 1,
            TIMER_UPDATE_INTERVAL: 1000,
            PRIORITY_UPDATE_INTERVAL: 30000,
            TOAST_DISPLAY_TIME: 3000,
            TOAST_ANIMATION_TIME: 300,
            
            // ê²€ì‚¬ ê´€ë ¨
            INSPECTION_PRODUCTS_COUNT: 3,
            INSPECTION_MAX_RETRY_COUNT: 3,
            CHECKLIST_ITEMS_COUNT: 8,
            SAFETY_CHECK_ITEMS_COUNT: 4,
            
            // ë¶ˆëŸ‰ ê´€ë ¨
            DEFECT_CONSECUTIVE_TIME_MINUTES: 30,
            DEFECT_CONSECUTIVE_COUNT_THRESHOLD: 3,
            
            // ì•ˆì „ ê´€ë ¨
            SAFETY_LEVEL_1_DAYS: 30,
            SAFETY_LEVEL_2_DAYS: 100,
            SAFETY_LEVEL_3_DAYS: 200
        };

        // ì •ì§€ ì‚¬ìœ  í…ìŠ¤íŠ¸ ë§¤í•‘
        const STOP_REASONS = {
            'coil_change': 'ì½”ì¼ì¤€ë¹„êµì²´',
            'bending_pack': 'ë°´ë”©í¬ì¥',
            'equipment_failure': 'ì„¤ë¹„ê³ ì¥',
            'mold_change': 'ê¸ˆí˜•êµì²´',
            'material_shortage': 'ìì¬ë¶€ì¡±',
            'maintenance': 'ì •ê¸°ì ê²€',
            'break': 'íœ´ì‹ì‹œê°„',
            'meeting': 'íšŒì˜/êµìœ¡',
            'other': 'ê¸°íƒ€'
        };

        // ì¤‘ë‹¨ ì‚¬ìœ  í…ìŠ¤íŠ¸ ë§¤í•‘
        const PAUSE_REASONS = {
            'worker_change': 'ì‘ì—…ì êµëŒ€',
            'urgent_order': 'ê¸´ê¸‰ ì‘ì—…',
            'meal_time': 'ì‹ì‚¬ ì‹œê°„',
            'material_shortage': 'ìì¬ ë¶€ì¡±',
            'quality_issue': 'í’ˆì§ˆ ë¬¸ì œ',
            'other': 'ê¸°íƒ€'
        };

        // ë¶ˆëŸ‰ ìœ í˜• í…ìŠ¤íŠ¸ ë§¤í•‘
        const DEFECT_TYPES = {
            'surface': 'í‘œë©´ë¶ˆëŸ‰',
            'dimension': 'ì¹˜ìˆ˜ë¶ˆëŸ‰',
            'deformation': 'ë³€í˜•',
            'foreign': 'ì´ë¬¼ì§ˆ',
            'crack': 'í¬ë™/íŒŒì†',
            'other': 'ê¸°íƒ€'
        };

        // ê¸´ê¸‰ìƒí™© ìœ í˜• ë§¤í•‘
        const EMERGENCY_TYPES = {
            'fire': 'ğŸ”¥ í™”ì¬/ì—°ê¸° ë°œìƒ',
            'accident': 'âš ï¸ ì•ˆì „ì‚¬ê³  (ë¶€ìƒ)',
            'gas_leak': 'ğŸ’¨ ê°€ìŠ¤/í™”í•™ë¬¼ì§ˆ ëˆ„ì¶œ',
            'power_failure': 'âš¡ ì •ì „/ì‹œìŠ¤í…œ ì¥ì• ',
            'earthquake': 'ğŸƒ ì§€ì§„/ìì—°ì¬í•´',
            'other': 'ğŸ“ ê¸°íƒ€ ì‘ê¸‰ìƒí™©'
        };

        // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
        const Utils = {
            // ì‹œê°„ ê´€ë ¨
            formatTime(date) {
                return date.toLocaleTimeString('ko-KR');
            },
            
            formatDate(date) {
                return date.toLocaleDateString('ko-KR');
            },
            
            formatDateTime(date) {
                return date.toLocaleString('ko-KR');
            },
            
            formatDuration(ms) {
                const minutes = Math.floor(ms / 60000);
                const seconds = Math.floor((ms % 60000) / 1000);
                return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            },
            
            getTimeDifference(startDate, endDate) {
                return endDate - startDate;
            },
            
            getElapsedMinutes(startDate) {
                return Math.floor((new Date() - startDate) / 60000);
            },
            
            // DOM ê´€ë ¨
            showModal(modalId) {
                document.getElementById(modalId).classList.remove('hidden');
            },
            
            hideModal(modalId) {
                document.getElementById(modalId).classList.add('hidden');
            },
            
            showElement(elementId) {
                document.getElementById(elementId).style.display = 'block';
            },
            
            hideElement(elementId) {
                document.getElementById(elementId).style.display = 'none';
            },
            
            setElementText(elementId, text) {
                document.getElementById(elementId).textContent = text;
            },
            
            setElementHtml(elementId, html) {
                document.getElementById(elementId).innerHTML = html;
            },
            
            setElementValue(elementId, value) {
                document.getElementById(elementId).value = value;
            },
            
            getElementValue(elementId) {
                return document.getElementById(elementId).value;
            },
            
            setButtonState(buttonId, enabled) {
                document.getElementById(buttonId).disabled = !enabled;
            },
            
            // ì‘ì—…ì ê´€ë ¨ í†µí•© í•¨ìˆ˜
            getWorkersInfo() {
                const allWorkers = [currentWorker];
                if (isTwoPersonWork && subWorkers.length > 0) {
                    return {
                        all: allWorkers.concat(subWorkers),
                        display: `${currentWorker}(ì£¼), ${subWorkers.join(', ')}(ë³´ì¡°)`,
                        simple: allWorkers.concat(subWorkers).join(', '),
                        count: allWorkers.concat(subWorkers).length
                    };
                }
                return {
                    all: allWorkers,
                    display: currentWorker,
                    simple: currentWorker,
                    count: 1
                };
            },
            
            // ë°ì´í„° ë³€í™˜
            parseNumber(value, defaultValue = 0) {
                const parsed = parseFloat(value);
                return isNaN(parsed) ? defaultValue : parsed;
            },
            
            // ê²€ì¦
            isValidNumber(value) {
                return !isNaN(parseFloat(value)) && isFinite(value);
            },
            
            isEmpty(value) {
                return value === null || value === undefined || value === '';
            },
            
            // ì•Œë¦¼ í†µí•©
            showAlert(message, type = 'info') {
                alert(message);
            },
            
            confirm(message) {
                return confirm(message);
            }
        };

        // ===== ì „ì—­ ë³€ìˆ˜ =====
        var currentWorker = '';
        var currentMachine = '';
        var subWorkers = [];
        var isTwoPersonWork = false;
        var selectedWork = null;
        var workStartTime = null;
        var workStatus = 'idle';
        var stopStartTime = null;
        var totalStopTime = 0;
        var defectRecords = [];
        var totalProduction = 0;
        var timerInterval = null;
        var stopLog = [];
        var independentStopStartTime = null;
        var isIndependentStop = false;
        var correctionWork = null;
        var workHistory = [];
        var currentLotNumber = '';
        var previousLotNumber = '';
        var currentMoldNumber = '';
        var previousMoldNumber = '';
        var startChecklist = {};
        var firstProductInspection = {};
        var isLotChanged = false;
        var inspectionRetryCount = 0;
        var hasFailedInspection = false;
        var dailySafetyChecked = false;
        
        // ì•ˆì „ í˜„í™© ë°ì´í„°
        var safetyData = {
            '1': { days: 89, lastAccident: '2024-10-28' },
            '2': { days: 156, lastAccident: '2024-07-22' },
            '3': { days: 127, lastAccident: '2024-08-20' },
            currentLine: '3',
            averageDays: 98,
            recordDays: 245
        };
        
        // ì‘ì—…ì ëª©ë¡
        var workerList = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ê¹€ìˆ˜ì •', 'ì´ì² ìˆ˜', 'ë°•ì˜í¬', 'ìµœë¯¼í˜¸', 'ì •ëŒ€í˜„', 'ê°•ë¯¸ì˜', 'í™ê¸¸ë™'];
        
        // ì œí’ˆë³„ ê²€ì‚¬ ê¸°ì¤€
        var productCriteria = {
            'M-BAR-KS': {
                length: { min: 2990, max: 3010, unit: 'mm' },
                width: { min: 98, max: 102, unit: 'mm' },
                bend: { max: 2, unit: 'mm' }
            },
            'RUNNER 30': {
                length: { min: 1992, max: 2008, unit: 'mm' },
                width: { min: 29, max: 31, unit: 'mm' },
                bend: { max: 1, unit: 'mm' }
            },
            'STUD': {
                length: { min: 1495, max: 1505, unit: 'mm' },
                width: { min: 78, max: 82, unit: 'mm' },
                bend: { max: 1.5, unit: 'mm' }
            }
        };
        
        // ìƒ˜í”Œ ì‘ì—… ë°ì´í„°
        var workOrders = {
            '1': [
                { 
                    id: 1, 
                    name: '1-0122-01', 
                    product: 'M-BAR-KS', 
                    customer: 'Aì‚¬', 
                    targetQty: 300, 
                    status: 'waiting', 
                    spec: '3000mm', 
                    pieces: 100, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 2,
                        deliveryTime: new Date(new Date().getTime() + 2 * 24 * 60 * 60 * 1000),
                        managerOrder: 2,
                        autoOrder: 0,
                        reason: ''
                    },
                    notifications: []
                },
                { 
                    id: 2, 
                    name: '1-0122-02', 
                    product: 'M-BAR-KS', 
                    customer: 'Aì‚¬', 
                    targetQty: 375, 
                    status: 'waiting', 
                    spec: '2500mm', 
                    pieces: 150, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 1,
                        deliveryTime: new Date(new Date().getTime() + 5 * 60 * 60 * 1000),
                        managerOrder: 1,
                        autoOrder: 0,
                        reason: 'ì¶œí•˜ì‹œê°„ ë³€ê²½'
                    },
                    notifications: [
                        {
                            type: 'priority_change',
                            message: 'ê¸´ê¸‰ì‘ì—…ìœ¼ë¡œ ë³€ê²½ë¨',
                            timestamp: new Date(new Date().getTime() - 30 * 60 * 1000).toLocaleTimeString('ko-KR')
                        }
                    ]
                },
                { 
                    id: 3, 
                    name: '1-0122-03', 
                    product: 'M-BAR-KS', 
                    customer: 'ì¬ê³ ìƒì‚°', 
                    targetQty: 600, 
                    status: 'waiting', 
                    spec: '3000mm', 
                    pieces: 200, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 3,
                        deliveryTime: new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000),
                        managerOrder: 3,
                        autoOrder: 0,
                        reason: ''
                    },
                    notifications: []
                }
            ],
            '2': [
                { 
                    id: 1, 
                    name: '2-0122-01', 
                    product: 'RUNNER 30', 
                    customer: 'Bì‚¬', 
                    targetQty: 400, 
                    status: 'completed', 
                    spec: '2000mm', 
                    pieces: 200, 
                    actualQty: 400, 
                    history: [],
                    priority: {
                        urgency: 3,
                        deliveryTime: new Date(new Date().getTime() - 2 * 60 * 60 * 1000),
                        managerOrder: 1,
                        autoOrder: 0,
                        reason: ''
                    },
                    notifications: []
                },
                { 
                    id: 2, 
                    name: '2-0122-02', 
                    product: 'RUNNER 30', 
                    customer: 'Cì‚¬', 
                    targetQty: 150, 
                    status: 'waiting', 
                    spec: '1500mm', 
                    pieces: 100, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 1,
                        deliveryTime: new Date(new Date().getTime() + 3 * 60 * 60 * 1000),
                        managerOrder: 1,
                        autoOrder: 0,
                        reason: 'ê³ ê° ìš”ì²­'
                    },
                    notifications: [
                        {
                            type: 'urgent_added',
                            message: 'ê³ ê° ìš”ì²­ìœ¼ë¡œ ê¸´ê¸‰ ì²˜ë¦¬',
                            timestamp: new Date(new Date().getTime() - 15 * 60 * 1000).toLocaleTimeString('ko-KR')
                        }
                    ]
                },
                { 
                    id: 3, 
                    name: '2-0122-03', 
                    product: 'RUNNER 30', 
                    customer: 'Bì‚¬', 
                    targetQty: 300, 
                    status: 'waiting', 
                    spec: '2500mm', 
                    pieces: 120, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 2,
                        deliveryTime: new Date(new Date().getTime() + 1 * 24 * 60 * 60 * 1000),
                        managerOrder: 2,
                        autoOrder: 0,
                        reason: ''
                    },
                    notifications: []
                }
            ],
            '3': [
                { 
                    id: 1, 
                    name: '3-0122-01', 
                    product: 'M-BAR-KS', 
                    customer: 'Aì‚¬', 
                    targetQty: 300, 
                    status: 'waiting', 
                    spec: '3000mm', 
                    pieces: 100, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 2,
                        deliveryTime: new Date(new Date().getTime() + 1 * 24 * 60 * 60 * 1000),
                        managerOrder: 2,
                        autoOrder: 0,
                        reason: ''
                    },
                    notifications: []
                },
                { 
                    id: 2, 
                    name: '3-0122-02', 
                    product: 'RUNNER 30', 
                    customer: 'Dì‚¬', 
                    targetQty: 300, 
                    status: 'waiting', 
                    spec: '2000mm', 
                    pieces: 150, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 1,
                        deliveryTime: new Date(new Date().getTime() + 4 * 60 * 60 * 1000),
                        managerOrder: 1,
                        autoOrder: 0,
                        reason: 'ë‚©ê¸° ë‹¨ì¶•'
                    },
                    notifications: [
                        {
                            type: 'delivery_changed',
                            message: 'ë‚©ê¸°ê°€ ë‹¹ê²¨ì¡ŒìŠµë‹ˆë‹¤',
                            timestamp: new Date(new Date().getTime() - 45 * 60 * 1000).toLocaleTimeString('ko-KR')
                        }
                    ]
                },
                { 
                    id: 3, 
                    name: '3-0122-03', 
                    product: 'STUD', 
                    customer: 'Bì‚¬', 
                    targetQty: 150, 
                    status: 'waiting', 
                    spec: '1500mm', 
                    pieces: 100, 
                    actualQty: 0, 
                    history: [],
                    priority: {
                        urgency: 3,
                        deliveryTime: new Date(new Date().getTime() + 3 * 24 * 60 * 60 * 1000),
                        managerOrder: 3,
                        autoOrder: 0,
                        reason: ''
                    },
                    notifications: []
                }
            ]
        };
        
        // ê°œì„ ëœ ë¶ˆëŸ‰ ê´€ë¦¬ ë³€ìˆ˜
        var detailedDefectRecords = [];
        var selectedDefectType = '';
        var selectedCause = '';
        var defectAnalysisStep = 1;
        
        // ë¶ˆëŸ‰ ì›ì¸ ë¶„ì„ ë°ì´í„°
        var defectCauses = {
            'surface': {
                'ì„¤ë¹„ ê´€ë ¨': [
                    'ë¡¤ëŸ¬ í‘œë©´ ì†ìƒ',
                    'ê°€ì´ë“œ ì •ë ¬ ë¶ˆëŸ‰',
                    'ìœ¤í™œìœ  ë¶€ì¡±',
                    'ì²­ì†Œ ë¶ˆëŸ‰',
                    'ì˜¨ë„ ì„¤ì • ì´ìƒ'
                ],
                'ìì¬ ê´€ë ¨': [
                    'ì½”ì¼ í‘œë©´ í’ˆì§ˆ ë¶ˆëŸ‰',
                    'ì½”ì¼ ë‘ê»˜ í¸ì°¨',
                    'ì½”ì¼ ì„±ë¶„ ì´ìƒ',
                    'ë³´ê´€ ì¤‘ ì˜¤ì—¼',
                    'ìš´ë°˜ ì¤‘ ì†ìƒ'
                ],
                'ì‘ì—… ê´€ë ¨': [
                    'ì‘ì—…ì ë¶€ì£¼ì˜',
                    'ì‘ì—… ì†ë„ ê³¼ë„',
                    'ì·¨ê¸‰ ë°©ë²• ë¶€ì ì ˆ',
                    'ì ê²€ ì†Œí™€',
                    'êµìœ¡ ë¶€ì¡±'
                ],
                'í™˜ê²½ ê´€ë ¨': [
                    'ì‘ì—…ì¥ ì²­ê²°ë„ ë¶€ì¡±',
                    'ì˜¨ë„/ìŠµë„ ì´ìƒ',
                    'ì§„ë™/ì¶©ê²©',
                    'ë¨¼ì§€/ì´ë¬¼ì§ˆ',
                    'ì¡°ëª… ë¶ˆëŸ‰'
                ]
            },
            'dimension': {
                'ì„¤ë¹„ ê´€ë ¨': [
                    'ê¸ˆí˜• ë§ˆëª¨',
                    'ì••ë ¥ ì„¤ì • ì´ìƒ',
                    'ì˜¨ë„ ì œì–´ ë¶ˆëŸ‰',
                    'ê¸°ê³„ ì •ë°€ë„ ì €í•˜',
                    'ì„¼ì„œ ì˜¤ì°¨'
                ],
                'ìì¬ ê´€ë ¨': [
                    'ì½”ì¼ ë‘ê»˜ í¸ì°¨',
                    'ì½”ì¼ í­ ë¶ˆëŸ‰',
                    'ì¬ì§ˆ ê²½ë„ ì´ìƒ',
                    'ì„±ë¶„ í¸ì°¨',
                    'ì—´ì²˜ë¦¬ ë¶ˆëŸ‰'
                ],
                'ì‘ì—… ê´€ë ¨': [
                    'ì„¤ì •ê°’ ì…ë ¥ ì˜¤ë¥˜',
                    'ì¸¡ì • ë°©ë²• ë¶€ì ì ˆ',
                    'ì ê²€ ì£¼ê¸° ë¯¸ì¤€ìˆ˜',
                    'ë³´ì • ì‘ì—… ì†Œí™€',
                    'ê²½í—˜ ë¶€ì¡±'
                ]
            },
            'deformation': {
                'ì„¤ë¹„ ê´€ë ¨': [
                    'ê¸ˆí˜• ì •ë ¬ ë¶ˆëŸ‰',
                    'ì••ë ¥ ë¶ˆê· ë“±',
                    'ì†ë„ ì œì–´ ì´ìƒ',
                    'ì§„ë™ ë°œìƒ',
                    'ë§ˆëª¨ ë¶€í’ˆ'
                ],
                'ìì¬ ê´€ë ¨': [
                    'ì½”ì¼ ì¥ë ¥ ì´ìƒ',
                    'ì¬ì§ˆ ì—°í™”',
                    'ë‘ê»˜ ë¶ˆê· ë“±',
                    'í‘œë©´ ì¡°ë„ ë¶ˆëŸ‰',
                    'ì”ë¥˜ ì‘ë ¥'
                ],
                'ì‘ì—… ê´€ë ¨': [
                    'ì‘ì—… ìˆœì„œ ì˜¤ë¥˜',
                    'í˜ ì¡°ì ˆ ë¶€ì ì ˆ',
                    'ê³ ì • ë°©ë²• ë¶ˆëŸ‰',
                    'ì·¨ê¸‰ ë¶€ì£¼ì˜',
                    'í’ˆì§ˆ í™•ì¸ ì†Œí™€'
                ]
            }
        };

        // ===== ê¸°ë³¸ í•¨ìˆ˜ë“¤ =====
        
        // ì•ˆì „ ìƒ‰ìƒ í´ë˜ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        function getSafetyColorClass(days) {
            if (days < CONFIG.SAFETY_LEVEL_1_DAYS) return 'level-1';
            if (days < CONFIG.SAFETY_LEVEL_2_DAYS) return 'level-2';
            if (days < CONFIG.SAFETY_LEVEL_3_DAYS) return 'level-3';
            return 'level-4';
        }
        
        // ì•ˆì „ í˜„í™© í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSafetyStatus() {
            var currentLineDays = safetyData[safetyData.currentLine].days;
            var colorClass = getSafetyColorClass(currentLineDays);
            
            var currentLineSafetyEl = document.getElementById('currentLineSafety');
            currentLineSafetyEl.textContent = safetyData.currentLine + 'í˜¸ê¸° ' + currentLineDays + 'ì¼ ë¬´ì‚¬ê³ ';
            currentLineSafetyEl.className = 'safety-days ' + colorClass;
            
            Utils.setElementText('averageSafety', safetyData.averageDays);
            Utils.setElementText('recordSafety', safetyData.recordDays);
        }
        
        // 2ì¸ ì‘ì—… í† ê¸€
        function toggleSubWorker() {
            var checkbox = document.getElementById('twoPersonWork');
            var section = document.getElementById('subWorkerSection');
            
            if (checkbox.checked) {
                Utils.showElement('subWorkerSection');
                generateSubWorkerList();
            } else {
                Utils.hideElement('subWorkerSection');
                subWorkers = [];
                updateSelectedSubWorkers();
            }
        }
        
        // ë³´ì¡°ì‘ì—…ì ëª©ë¡ ìƒì„±
        function generateSubWorkerList() {
            var container = document.getElementById('subWorkerList');
            var mainWorker = Utils.getElementValue('workerName');
            
            container.innerHTML = '';
            
            workerList.forEach(function(worker) {
                if (worker !== mainWorker) {
                    var div = document.createElement('div');
                    div.className = 'checkbox-item';
                    
                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = worker;
                    checkbox.onchange = function() {
                        updateSubWorkers(worker, this.checked);
                    };
                    
                    var label = document.createElement('span');
                    label.textContent = worker;
                    
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    container.appendChild(div);
                }
            });
        }
        
        // ë³´ì¡°ì‘ì—…ì ì—…ë°ì´íŠ¸
        function updateSubWorkers(worker, isSelected) {
            if (isSelected) {
                if (!subWorkers.includes(worker)) {
                    subWorkers.push(worker);
                }
            } else {
                subWorkers = subWorkers.filter(function(w) { return w !== worker; });
            }
            updateSelectedSubWorkers();
        }
        
        // ì„ íƒëœ ë³´ì¡°ì‘ì—…ì í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedSubWorkers() {
            var display = document.getElementById('selectedSubWorkers');
            if (subWorkers.length === 0) {
                display.textContent = 'ì„ íƒëœ ë³´ì¡°ì‘ì—…ì: ì—†ìŒ';
            } else {
                display.textContent = 'ì„ íƒëœ ë³´ì¡°ì‘ì—…ì: ' + subWorkers.join(', ');
            }
        }
        
        // ì£¼ì‘ì—…ì ë³€ê²½ ì‹œ ë³´ì¡°ì‘ì—…ì ëª©ë¡ ê°±ì‹ 
        document.addEventListener('DOMContentLoaded', function() {
            var mainWorkerSelect = document.getElementById('workerName');
            mainWorkerSelect.addEventListener('change', function() {
                if (document.getElementById('twoPersonWork').checked) {
                    generateSubWorkerList();
                }
            });
        });
        
        // ë¡œê·¸ì¸ í•¨ìˆ˜
        function doLogin() {
            currentWorker = Utils.getElementValue('workerName');
            currentMachine = Utils.getElementValue('machineNo');
            isTwoPersonWork = document.getElementById('twoPersonWork').checked;
            
            if (!currentWorker || !currentMachine) {
                Utils.showAlert('ì‘ì—…ìì™€ í˜¸ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (isTwoPersonWork && subWorkers.length === 0) {
                Utils.showAlert('ë³´ì¡°ì‘ì—…ìë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            // ì•ˆì „ ë°ì´í„°ì˜ í˜„ì¬ ë¼ì¸ ì—…ë°ì´íŠ¸
            safetyData.currentLine = currentMachine;
            
            // ì¼ì¼ ì•ˆì „ì ê²€ë¶€í„° ì‹œì‘
            showDailySafetyModal();
        }
        
        // ì¼ì¼ ì•ˆì „ì ê²€ ëª¨ë‹¬ í‘œì‹œ
        function showDailySafetyModal() {
            Utils.showModal('dailySafetyModal');
            
            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            for (var i = 1; i <= CONFIG.SAFETY_CHECK_ITEMS_COUNT; i++) {
                document.getElementById('safetyCheck' + i).checked = false;
            }
            
            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            Utils.setButtonState('dailySafetyConfirmBtn', false);
            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            for (var i = 1; i <= CONFIG.SAFETY_CHECK_ITEMS_COUNT; i++) {
                document.getElementById('safetyCheck' + i).addEventListener('change', updateDailySafetyButton);
            }
        }
        
        // ì¼ì¼ ì•ˆì „ì ê²€ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateDailySafetyButton() {
            var allChecked = true;
            for (var i = 1; i <= CONFIG.SAFETY_CHECK_ITEMS_COUNT; i++) {
                if (!document.getElementById('safetyCheck' + i).checked) {
                    allChecked = false;
                    break;
                }
            }
            Utils.setButtonState('dailySafetyConfirmBtn', allChecked);
        }
        
        // ì¼ì¼ ì•ˆì „ì ê²€ í™•ì¸
        function confirmDailySafety() {
            dailySafetyChecked = true;
            
            Utils.hideModal('dailySafetyModal');
            
            // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            
            // ì‘ì—…ì ì •ë³´ í‘œì‹œ
            updateWorkerDisplay();
            
            // ì•ˆì „ í˜„í™© í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSafetyStatus();
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            timerInterval = setInterval(updateTime, CONFIG.TIMER_UPDATE_INTERVAL);
            updateTime();
            
            loadWorkList();
            updateKPI();
            
            // ìš°ì„ ìˆœìœ„ ë³€ê²½ ì‹œë®¬ë ˆì´ì…˜
            setInterval(simulatePriorityChange, CONFIG.PRIORITY_UPDATE_INTERVAL);
            
            Utils.showAlert('ì•ˆì „ì ê²€ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nì•ˆì „í•œ í•˜ë£¨ ë˜ì„¸ìš”! ğŸ‘·â€â™‚ï¸');
        }
        
        // ê¸´ê¸‰ìƒí™© ëª¨ë‹¬ í‘œì‹œ
        function showEmergencyModal() {
            Utils.showModal('emergencyModal');
        }
        
        // ê¸´ê¸‰ìƒí™© ëª¨ë‹¬ ë‹«ê¸°
        function closeEmergencyModal() {
            Utils.hideModal('emergencyModal');
        }
        
        // ê¸´ê¸‰ìƒí™© ì‹ ê³ 
        function reportEmergency(type) {
            var emergencyReport = {
                type: type,
                typeText: EMERGENCY_TYPES[type],
                time: new Date(),
                reporter: currentWorker,
                machine: currentMachine,
                location: currentMachine + 'í˜¸ê¸°',
                participants: Utils.getWorkersInfo().all
            };
            
            // ì‹¤ì œë¡œëŠ” ê´€ë¦¬ì ì‹œìŠ¤í…œì— ì¦‰ì‹œ ì•Œë¦¼ ì „ì†¡
            console.log('ê¸´ê¸‰ìƒí™© ì‹ ê³ :', emergencyReport);
            
            Utils.hideModal('emergencyModal');
            
            // ê¸´ê¸‰ìƒí™©ë³„ ëŒ€ì‘ ê°€ì´ë“œ
            var responseGuide = getEmergencyGuide(type);
            
            Utils.showAlert('ğŸš¨ ê¸´ê¸‰ìƒí™©ì´ ì‹ ê³ ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' +
                  'ì‹ ê³  ë‚´ìš©: ' + EMERGENCY_TYPES[type] + '\n' +
                  'ì‹ ê³  ì‹œê°„: ' + Utils.formatTime(new Date()) + '\n' +
                  'ì‹ ê³  ìœ„ì¹˜: ' + currentMachine + 'í˜¸ê¸°\n\n' +
                  'ğŸ“ ê´€ë¦¬ìì—ê²Œ ì¦‰ì‹œ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n' +
                  'ğŸ”” ëŒ€ì‘ ê°€ì´ë“œ:\n' + responseGuide);
        }
        
        // ê¸´ê¸‰ìƒí™©ë³„ ëŒ€ì‘ ê°€ì´ë“œ
        function getEmergencyGuide(type) {
            var guides = {
                'fire': '1. ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨\n2. ì£¼ë³€ ì¸ì› ëŒ€í”¼\n3. 119 ì‹ ê³ \n4. ì†Œí™”ê¸° ì‚¬ìš© (ì•ˆì „í•œ ê²½ìš°)',
                'accident': '1. ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨\n2. ë¶€ìƒì ì‘ê¸‰ì²˜ì¹˜\n3. 119 ì‹ ê³ \n4. í˜„ì¥ ë³´ì¡´',
                'gas_leak': '1. ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨\n2. í™˜ê¸° ì‹¤ì‹œ\n3. ëˆ„ì¶œ ì§€ì ì—ì„œ ëŒ€í”¼\n4. í™”ê¸° ì‚¬ìš© ê¸ˆì§€',
                'power_failure': '1. ì„¤ë¹„ ìˆ˜ë™ ì •ì§€\n2. ì•ˆì „ ìœ„ì¹˜ë¡œ ì´ë™\n3. ë¹„ìƒì¡°ëª… í™•ì¸\n4. ë³µêµ¬ ëŒ€ê¸°',
                'earthquake': '1. ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨\n2. ë‹¨ë‹¨í•œ êµ¬ì¡°ë¬¼ ì•„ë˜ ëŒ€í”¼\n3. ì§„ë™ ë©ˆì¶˜ í›„ ëŒ€í”¼\n4. ì—˜ë¦¬ë² ì´í„° ì‚¬ìš© ê¸ˆì§€',
                'other': '1. ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨\n2. ì•ˆì „ í™•ë³´\n3. ê´€ë¦¬ì ì§€ì‹œ ëŒ€ê¸°\n4. í˜„ì¥ ë³´ì¡´'
            };
            return guides[type] || 'ê´€ë¦¬ì ì§€ì‹œë¥¼ ë”°ë¥´ì„¸ìš”.';
        }
        
        // ì‘ì—…ì ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateWorkerDisplay() {
            var mainInfo = currentMachine + 'í˜¸ê¸° | ' + currentWorker + ' (ì£¼ì‘ì—…ì)';
            Utils.setElementText('workerInfo', mainInfo);
            
            var subInfo = document.getElementById('subWorkerInfo');
            if (isTwoPersonWork && subWorkers.length > 0) {
                subInfo.textContent = 'ë³´ì¡°ì‘ì—…ì: ' + subWorkers.join(', ');
                Utils.showElement('subWorkerInfo');
            } else {
                Utils.hideElement('subWorkerInfo');
            }
        }
        
        // ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            var now = new Date();
            Utils.setElementText('currentTime', Utils.formatTime(now));
            
            // ì‘ì—… ì‹œê°„ ê³„ì‚°
            if (workStartTime && workStatus === 'working') {
                var elapsed = Math.floor((now - workStartTime - totalStopTime) / 1000);
                var minutes = Math.floor(elapsed / 60);
                var seconds = elapsed % 60;
                Utils.setElementText('workTime', 
                    String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0'));
            }
            
            // ì‘ì—… ì¤‘ ì„¤ë¹„ ì •ì§€ ì‹œê°„ í‘œì‹œ
            if (workStatus === 'stopped' && stopStartTime) {
                var stopElapsed = Math.floor((now - stopStartTime) / 1000);
                var stopMinutes = Math.floor(stopElapsed / 60);
                var stopSeconds = stopElapsed % 60;
                var currentWorkEl = document.getElementById('currentWork');
                currentWorkEl.innerHTML = 
                    currentWorkEl.innerHTML.split('<br>')[0] + 
                    '<br><span style="color: #ef4444;">ì •ì§€ ì‹œê°„: ' + 
                    String(stopMinutes).padStart(2, '0') + ':' + 
                    String(stopSeconds).padStart(2, '0') + '</span>';
            }
            
            // ë…ë¦½ ì„¤ë¹„ ì •ì§€ ì‹œê°„ í‘œì‹œ
            if (isIndependentStop && independentStopStartTime) {
                var indStopElapsed = Math.floor((now - independentStopStartTime) / 1000);
                var indStopMinutes = Math.floor(indStopElapsed / 60);
                var indStopSeconds = indStopElapsed % 60;
                Utils.setElementText('independentStopTime', 
                    'ì •ì§€ ì‹œê°„: ' + String(indStopMinutes).padStart(2, '0') + ':' + 
                    String(indStopSeconds).padStart(2, '0'));
            } else {
                Utils.setElementText('independentStopTime', '');
            }
        }
        
        // ìš°ì„ ìˆœìœ„ ê³„ì‚°
        function calculatePriority(work) {
            var now = new Date();
            var urgencyScore = 0;
            var deliveryScore = 0;
            var managerScore = 0;
            
            // ê¸´ê¸‰ë„ ì ìˆ˜ (40%)
            switch(work.priority.urgency) {
                case 1: urgencyScore = 100; break;
                case 2: urgencyScore = 70; break;
                case 3: urgencyScore = 40; break;
                default: urgencyScore = 20; break;
            }
            
            // ë‚©ê¸°ì‹œê°„ ì ìˆ˜ (30%)
            var timeDiff = work.priority.deliveryTime - now;
            var hoursLeft = timeDiff / (1000 * 60 * 60);
            
            if (hoursLeft < 0) deliveryScore = 0;
            else if (hoursLeft <= 4) deliveryScore = 100;
            else if (hoursLeft <= 8) deliveryScore = 90;
            else if (hoursLeft <= 24) deliveryScore = 70;
            else if (hoursLeft <= 72) deliveryScore = 50;
            else deliveryScore = 30;
            
            // ê´€ë¦¬ì ì§€ì • ì ìˆ˜ (30%)
            managerScore = Math.max(0, 100 - (work.priority.managerOrder - 1) * 20);
            
            // ê°€ì¤‘í‰ê·  ê³„ì‚°
            var totalScore = (urgencyScore * 0.4) + (deliveryScore * 0.3) + (managerScore * 0.3);
            
            return Math.round(totalScore);
        }
        
        // ì‘ì—… ëª©ë¡ ìë™ ì •ë ¬
        function sortWorksByPriority(works) {
            return works
                .filter(work => work.status !== 'completed')
                .map(work => {
                    work.priority.autoOrder = calculatePriority(work);
                    return work;
                })
                .sort((a, b) => b.priority.autoOrder - a.priority.autoOrder);
        }
        
        // ìš°ì„ ìˆœìœ„ í´ë˜ìŠ¤ ë°˜í™˜
        function getPriorityClass(urgency) {
            switch(urgency) {
                case 1: return 'urgent';
                case 2: return 'priority';
                case 3: return 'normal';
                default: return 'low';
            }
        }
        
        // ìš°ì„ ìˆœìœ„ ì•„ì´ì½˜ ë°˜í™˜
        function getPriorityIcon(urgency) {
            switch(urgency) {
                case 1: return 'ğŸ”¥';
                case 2: return 'âš¡';
                case 3: return 'ğŸ“‹';
                default: return 'ğŸ“';
            }
        }
        
        // ë‚©ê¸°ê¹Œì§€ ë‚¨ì€ ì‹œê°„ ê³„ì‚°
        function getDeliveryTimeLeft(deliveryTime) {
            var now = new Date();
            var timeDiff = deliveryTime - now;
            var hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
            var minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hoursLeft < 0) return 'ë‚©ê¸° ì§€ë‚¨';
            if (hoursLeft === 0) return minutesLeft + 'ë¶„ ë‚¨ìŒ';
            if (hoursLeft < 24) return hoursLeft + 'ì‹œê°„ ' + minutesLeft + 'ë¶„ ë‚¨ìŒ';
            
            var daysLeft = Math.floor(hoursLeft / 24);
            return daysLeft + 'ì¼ ë‚¨ìŒ';
        }
        
        // ì‘ì—… ê°€ì´ë“œ ì—…ë°ì´íŠ¸
        function updateWorkGuide() {
            var works = workOrders[currentMachine] || [];
            var sortedWorks = sortWorksByPriority(works);
            
            var recommendedWorkEl = document.getElementById('recommendedWork');
            var deliveryCountdownEl = document.getElementById('deliveryCountdown');
            
            if (sortedWorks.length === 0) {
                recommendedWorkEl.textContent = 'ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤';
                deliveryCountdownEl.textContent = '-';
                deliveryCountdownEl.className = 'delivery-countdown';
                return;
            }
            
            var nextWork = sortedWorks[0];
            var timeLeft = getDeliveryTimeLeft(nextWork.priority.deliveryTime);
            
            recommendedWorkEl.textContent = nextWork.name + ' (' + nextWork.product + ')';
            deliveryCountdownEl.textContent = 'â° ' + timeLeft;
            
            // ê¸´ê¸‰ë„ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ë³€ê²½
            if (nextWork.priority.urgency === 1) {
                deliveryCountdownEl.className = 'delivery-countdown urgent';
            } else {
                deliveryCountdownEl.className = 'delivery-countdown';
            }
        }
        
        // ì‹¤ì‹œê°„ ì•Œë¦¼ í† ìŠ¤íŠ¸
        function showToast(type, title, message) {
            var container = document.getElementById('toastContainer');
            var toast = document.createElement('div');
            toast.className = 'toast ' + type;
            
            var iconMap = {
                'success': 'âœ…',
                'warning': 'âš ï¸',
                'error': 'âŒ',
                'info': 'ğŸ””'
            };
            
            toast.innerHTML = `
                <div class="toast-header">
                    <span class="toast-icon">${iconMap[type]}</span>
                    <span>${title}</span>
                </div>
                <div class="toast-message">${message}</div>
            `;
            
            container.appendChild(toast);
            
            // ìë™ ì œê±°
            setTimeout(function() {
                toast.style.animation = 'slideOut 0.3s ease-out forwards';
                setTimeout(function() {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, CONFIG.TOAST_ANIMATION_TIME);
            }, CONFIG.TOAST_DISPLAY_TIME);
        }
        
        // ìš°ì„ ìˆœìœ„ ë³€ê²½ ì‹œë®¬ë ˆì´ì…˜
        function simulatePriorityChange() {
            var works = workOrders[currentMachine] || [];
            if (works.length > 0) {
                var randomWork = works[Math.floor(Math.random() * works.length)];
                if (randomWork.status !== 'completed') {
                    var oldUrgency = randomWork.priority.urgency;
                    randomWork.priority.urgency = 1;
                    randomWork.priority.reason = 'ê´€ë¦¬ì ì§€ì‹œ';
                    
                    randomWork.notifications.push({
                        type: 'priority_change',
                        message: 'ê´€ë¦¬ìê°€ ê¸´ê¸‰ì‘ì—…ìœ¼ë¡œ ë³€ê²½',
                        timestamp: Utils.formatTime(new Date())
                    });
                    
                    showToast('warning', 'ìš°ì„ ìˆœìœ„ ë³€ê²½', 
                        randomWork.name + 'ì´(ê°€) ê¸´ê¸‰ì‘ì—…ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    loadWorkList();
                    updateWorkGuide();
                }
            }
        }
        
        // ì‘ì—… ëª©ë¡ ë¡œë“œ
        function loadWorkList() {
            var workListDiv = document.getElementById('workList');
            var works = workOrders[currentMachine] || [];
            
            // ìŠ¤ë§ˆíŠ¸ ì •ë ¬ ì ìš©
            var sortedWorks = sortWorksByPriority(works);
            var completedWorks = works.filter(work => work.status === 'completed');
            
            workListDiv.innerHTML = '';
            
            // ëŒ€ê¸°/ì§„í–‰ ì¤‘ì¸ ì‘ì—… í‘œì‹œ
            sortedWorks.forEach(function(work, index) {
                var workElement = createWorkElement(work, index);
                workListDiv.appendChild(workElement);
            });
            
            // ì™„ë£Œëœ ì‘ì—… í‘œì‹œ
            completedWorks.forEach(function(work) {
                var completedElement = createCompletedWorkElement(work);
                workListDiv.appendChild(completedElement);
            });
            
            // ì‘ì—… ê°€ì´ë“œ ì—…ë°ì´íŠ¸
            updateWorkGuide();
        }
        
        // ì‘ì—… ìš”ì†Œ ìƒì„±
        function createWorkElement(work, index) {
            var div = document.createElement('div');
            div.className = 'work-item ' + getPriorityClass(work.priority.urgency);
            
            // 2ì¸ ì‘ì—… ì´ë ¥ì´ ìˆëŠ” ê²½ìš° ìŠ¤íƒ€ì¼ ì¶”ê°€
            var hasTwoPersonHistory = work.history && work.history.some(function(h) {
                return h.workers && h.workers.length > 1;
            });
            
            if (hasTwoPersonHistory) {
                div.classList.add('two-person-work');
            }
            
            // ìƒíƒœë³„ ìŠ¤íƒ€ì¼
            if (work.status === 'paused') {
                div.style.borderColor = '#f59e0b';
                div.style.backgroundColor = '#fef3c7';
            }
            
            var statusText = work.status === 'paused' ? 'ì¤‘ë‹¨ë¨' : 
                           work.status === 'working' ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°';
            
            // ìˆœì„œ ë°°ì§€
            var orderBadge = '';
            if (index === 0) orderBadge = '<div class="work-order-badge first">1ìˆœìœ„ â­</div>';
            else if (index === 1) orderBadge = '<div class="work-order-badge second">2ìˆœìœ„</div>';
            else if (index === 2) orderBadge = '<div class="work-order-badge third">3ìˆœìœ„</div>';
            else orderBadge = '<div class="work-order-badge">' + (index + 1) + 'ìˆœìœ„</div>';
            
            // ì•Œë¦¼ ë°°ì§€
            var notificationBadge = '';
            if (work.notifications.length > 0) {
                notificationBadge = '<div class="notification-badge">' + work.notifications.length + '</div>';
            }
            
            // ìš°ì„ ìˆœìœ„ ì•„ì´ì½˜
            var priorityIcon = getPriorityIcon(work.priority.urgency);
            var urgencyText = '';
            switch(work.priority.urgency) {
                case 1: urgencyText = 'ê¸´ê¸‰'; break;
                case 2: urgencyText = 'ìš°ì„ '; break;
                case 3: urgencyText = 'ì¼ë°˜'; break;
                default: urgencyText = 'ì—¬ìœ '; break;
            }
            
            // ë‚©ê¸° ì •ë³´
            var deliveryInfo = getDeliveryTimeLeft(work.priority.deliveryTime);
            var deliveryClass = '';
            if (work.priority.urgency === 1) deliveryClass = 'urgent';
            else if (deliveryInfo.includes('ì‹œê°„')) deliveryClass = 'today';
            
            // ë§ˆì§€ë§‰ ë©”ëª¨ í™•ì¸
            var lastMemo = '';
            var lastWorkers = '';
            if (work.history && work.history.length > 0) {
                var lastHistory = work.history[work.history.length - 1];
                if (lastHistory.memo) {
                    lastMemo = lastHistory.memo;
                }
                if (lastHistory.workers && lastHistory.workers.length > 1) {
                    lastWorkers = ' (2ì¸ ì‘ì—…: ' + lastHistory.workers.join(', ') + ')';
                }
            }
            
            // ìµœì¢… ì‹¤ì  ê³„ì‚°
            var finalActualQty = work.actualQty + (work.correction ? work.correction.adjustedQty : 0);
            var correctionText = work.correction ? ' (ìˆ˜ì •ë¨ ğŸ”„)' : '';
            
            div.innerHTML = orderBadge + notificationBadge +
                           '<div class="work-priority-icons">' +
                           '<span class="priority-icon">' + priorityIcon + '</span>' +
                           '<span style="font-weight: bold; color: #374151;">[' + urgencyText + ']</span>' +
                           '<span style="background: #e5e7eb; color: #374151; padding: 2px 6px; border-radius: 4px; font-size: 11px; margin-left: 5px;">ì ìˆ˜: ' + work.priority.autoOrder + '</span>' +
                           '</div>' +
                           '<strong>' + work.name + '</strong> - ' + work.product + 
                           '<br>ê±°ë˜ì²˜: ' + work.customer + 
                           '<br>ê·œê²©: ' + work.spec + ' Ã— ' + work.pieces + 'EA' +
                           ' | ëª©í‘œ: ' + work.targetQty + 'm' +
                           (finalActualQty > 0 ? ' | ì‹¤ì : ' + finalActualQty + 'm' + correctionText : '') +
                           '<br>ìƒíƒœ: ' + statusText + lastWorkers +
                           '<div class="delivery-info ' + deliveryClass + '">ğŸ“… ë‚©ê¸°: ' + deliveryInfo + '</div>';
            
            // ì‚¬ìœ ê°€ ìˆìœ¼ë©´ í‘œì‹œ
            if (work.priority.reason) {
                div.innerHTML += '<div style="font-size: 11px; color: #6b7280; margin-top: 3px;">ğŸ”„ ' + work.priority.reason + '</div>';
            }
            
            // ì‘ì—… ì´ë ¥ì´ ìˆìœ¼ë©´ í‘œì‹œ
            if (work.history && work.history.length > 0) {
                div.innerHTML += '<br><span style="font-size: 12px; color: #666;">ì‘ì—…ì´ë ¥: ' + work.history.length + 'ê±´</span>';
            }
            
            // ë©”ëª¨ê°€ ìˆìœ¼ë©´ í‘œì‹œ
            if (lastMemo) {
                div.innerHTML += '<br><span style="font-size: 12px; color: #3b82f6;">ğŸ“ ë©”ëª¨: ' + 
                               (lastMemo.length > 30 ? lastMemo.substring(0, 30) + '...' : lastMemo) + '</span>';
            }
            
            // ì•Œë¦¼ì´ ìˆìœ¼ë©´ í‘œì‹œ
            if (work.notifications.length > 0) {
                var notificationList = '<div class="notification-list">';
                work.notifications.slice(-2).forEach(function(notification) {
                    notificationList += '<div class="notification-item">ğŸ”” ' + notification.message + ' (' + notification.timestamp + ')</div>';
                });
                notificationList += '</div>';
                div.innerHTML += notificationList;
            }
            
            // ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€
            if (work.status === 'completed' && canCorrectWork(work)) {
                var correctionBtn = document.createElement('button');
                correctionBtn.className = 'btn';
                correctionBtn.style.cssText = 'font-size: 12px; padding: 5px 10px; margin-top: 10px; background: #f59e0b;';
                correctionBtn.textContent = 'ğŸ“ ì‹¤ì  ìˆ˜ì •';
                correctionBtn.onclick = function(e) {
                    e.stopPropagation();
                    showCorrectionModal(work);
                };
                div.appendChild(correctionBtn);
            }
            
            div.onclick = function() {
                if (work.status !== 'completed') {
                    selectWork(work);
                }
            };
            
            return div;
        }
        
        // ì™„ë£Œëœ ì‘ì—… ìš”ì†Œ ìƒì„±
        function createCompletedWorkElement(work) {
            var div = document.createElement('div');
            div.className = 'work-item';
            div.style.opacity = '0.5';
            div.style.order = '999';
            
            var finalActualQty = work.actualQty + (work.correction ? work.correction.adjustedQty : 0);
            var correctionText = work.correction ? ' (ìˆ˜ì •ë¨ ğŸ”„)' : '';
            
            div.innerHTML = '<div class="work-order-badge" style="background: #10b981;">ì™„ë£Œ</div>' +
                           '<strong>' + work.name + '</strong> - ' + work.product + 
                           '<br>ê±°ë˜ì²˜: ' + work.customer + 
                           '<br>ê·œê²©: ' + work.spec + ' Ã— ' + work.pieces + 'EA' +
                           ' | ëª©í‘œ: ' + work.targetQty + 'm | ì‹¤ì : ' + finalActualQty + 'm' + correctionText +
                           '<br>ìƒíƒœ: ì™„ë£Œ';
            
            // ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€
            if (canCorrectWork(work)) {
                var correctionBtn = document.createElement('button');
                correctionBtn.className = 'btn';
                correctionBtn.style.cssText = 'font-size: 12px; padding: 5px 10px; margin-top: 10px; background: #f59e0b;';
                correctionBtn.textContent = 'ğŸ“ ì‹¤ì  ìˆ˜ì •';
                correctionBtn.onclick = function(e) {
                    e.stopPropagation();
                    showCorrectionModal(work);
                };
                div.appendChild(correctionBtn);
            }
            
            return div;
        }
        
        // ì‘ì—… ì„ íƒ
        function selectWork(work) {
            selectedWork = work;
            
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.work-item').forEach(function(item) {
                item.classList.remove('selected');
                var existingCheckbox = item.querySelector('.selected-checkbox');
                var existingLabel = item.querySelector('.selected-label');
                if (existingCheckbox) existingCheckbox.remove();
                if (existingLabel) existingLabel.remove();
            });
            
            // ìƒˆë¡œìš´ ì„ íƒ í‘œì‹œ
            var selectedItem = event.target.closest('.work-item');
            selectedItem.classList.add('selected');
            
            // ì²´í¬ë°•ìŠ¤ ì¶”ê°€
            var checkbox = document.createElement('div');
            checkbox.className = 'selected-checkbox';
            checkbox.innerHTML = 'âœ“';
            selectedItem.appendChild(checkbox);
            
            // ì„ íƒ ë¼ë²¨ ì¶”ê°€
            var label = document.createElement('div');
            label.className = 'selected-label';
            label.textContent = 'âœ… ì„ íƒëœ ì‘ì—…';
            selectedItem.appendChild(label);
            
            // ë²„íŠ¼ í™œì„±í™”
            if (work.status === 'paused') {
                Utils.setButtonState('startBtn', false);
                Utils.setButtonState('resumeWorkBtn', true);
                Utils.setElementText('currentWork', 'ì„ íƒëœ ì‘ì—…: ' + work.name + ' (ì¤‘ë‹¨ë¨ - ì‹¤ì : ' + work.actualQty + 'm)');
                
                // ë§ˆì§€ë§‰ ë©”ëª¨ í‘œì‹œ
                var lastMemo = '';
                if (work.history && work.history.length > 0) {
                    for (var i = work.history.length - 1; i >= 0; i--) {
                        if (work.history[i].memo) {
                            lastMemo = work.history[i].memo;
                            break;
                        }
                    }
                }
                if (lastMemo) {
                    document.getElementById('currentWork').innerHTML += 
                        '<br><span style="font-size: 12px; color: #666;">ì´ì „ ë©”ëª¨: ' + lastMemo + '</span>';
                }
            } else {
                Utils.setButtonState('startBtn', true);
                Utils.setButtonState('resumeWorkBtn', false);
                
                // ìš°ì„ ìˆœìœ„ ì •ë³´ì™€ í•¨ê»˜ í‘œì‹œ
                var priorityText = '';
                switch(work.priority.urgency) {
                    case 1: priorityText = ' ğŸ”¥ [ê¸´ê¸‰]'; break;
                    case 2: priorityText = ' âš¡ [ìš°ì„ ]'; break;
                    case 3: priorityText = ' ğŸ“‹ [ì¼ë°˜]'; break;
                    default: priorityText = ' ğŸ“ [ì—¬ìœ ]'; break;
                }
                
                var deliveryInfo = getDeliveryTimeLeft(work.priority.deliveryTime);
                Utils.setElementHtml('currentWork', 
                    '<span style="color: #3b82f6; font-weight: bold;">âœ… ì„ íƒëœ ì‘ì—…:</span> ' + 
                    work.name + priorityText + 
                    '<br><span style="font-size: 12px; color: #666;">ğŸ“… ë‚©ê¸°: ' + deliveryInfo + '</span>');
            }
            
            // ì„ íƒ íš¨ê³¼ìŒ ì‹œë®¬ë ˆì´ì…˜
            console.log('ì‘ì—… ì„ íƒë¨:', work.name);
            
            // í–…í‹± í”¼ë“œë°± ì‹œë®¬ë ˆì´ì…˜
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        // ì‘ì—… ì‹œì‘
        function startWork() {
            if (!selectedWork) {
                Utils.showAlert('ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            // LOT ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
            showLotModal();
        }
        
        // ì„¤ë¹„ ì •ì§€ ëª¨ë‹¬ í‘œì‹œ
        function showStopModal() {
            Utils.showModal('stopModal');
            Utils.setElementValue('stopReason', '');
        }
        
        // ì„¤ë¹„ ì •ì§€ í™•ì¸
        function confirmStop() {
            var reason = Utils.getElementValue('stopReason');
            if (!reason) {
                Utils.showAlert('ì •ì§€ ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            workStatus = 'stopped';
            stopStartTime = new Date();
            
            // ì •ì§€ ë¡œê·¸ ê¸°ë¡
            stopLog.push({
                reason: reason,
                reasonText: STOP_REASONS[reason] || reason,
                startTime: stopStartTime,
                workers: Utils.getWorkersInfo().all,
                workNo: selectedWork.name
            });
            
            Utils.setButtonState('stopBtn', false);
            Utils.setButtonState('resumeBtn', true);
            Utils.setButtonState('pauseBtn', false);
            
            // ë¶ˆëŸ‰ ì•Œë¦¼ ì„¹ì…˜ ìˆ¨ê¹€
            Utils.hideElement('defectAlertSection');
            
            Utils.hideModal('stopModal');
            Utils.showAlert('ì„¤ë¹„ê°€ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì„¤ë¹„ ì •ì§€ ì·¨ì†Œ
        function cancelStop() {
            Utils.hideModal('stopModal');
        }
        
        // ì‘ì—… ì¬ê°œ
        function resumeWork() {
            if (workStatus !== 'stopped') return;
            
            var stopEndTime = new Date();
            var stopDuration = stopEndTime - stopStartTime;
            totalStopTime += stopDuration;
            
            // ë§ˆì§€ë§‰ ì •ì§€ ë¡œê·¸ ì—…ë°ì´íŠ¸
            var lastStop = stopLog[stopLog.length - 1];
            lastStop.endTime = stopEndTime;
            lastStop.duration = stopDuration;
            
            workStatus = 'working';
            
            Utils.setButtonState('stopBtn', true);
            Utils.setButtonState('resumeBtn', false);
            Utils.setButtonState('pauseBtn', true);
            Utils.setButtonState('endBtn', true);
            
            // ì •ì§€ ê¸°ë¡ í™”ë©´ ì—…ë°ì´íŠ¸
            updateStopLogList();
            
            Utils.showAlert('ì‘ì—…ì„ ì¬ê°œí•©ë‹ˆë‹¤.');
        }
        
        // ì‘ì—… ì¤‘ë‹¨ ëª¨ë‹¬ í‘œì‹œ
        function showPauseWorkModal() {
            Utils.showModal('pauseWorkModal');
            Utils.setElementValue('pauseQty', '');
            Utils.setElementValue('pauseReason', '');
            Utils.setElementValue('pauseMemo', '');
            document.getElementById('pauseQty').focus();
        }
        
        // ì‘ì—… ì¤‘ë‹¨ í™•ì¸
        function confirmPauseWork() {
            var qty = Utils.getElementValue('pauseQty');
            var reason = Utils.getElementValue('pauseReason');
            var memo = Utils.getElementValue('pauseMemo').trim();
            
            if (!qty || qty <= 0) {
                Utils.showAlert('í˜„ì¬ê¹Œì§€ ìƒì‚°ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!reason) {
                Utils.showAlert('ì¤‘ë‹¨ ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            var pauseQty = parseFloat(qty);
            var workEndTime = new Date();
            
            // ì‘ì—… ì´ë ¥ ì¶”ê°€
            if (!selectedWork.history) {
                selectedWork.history = [];
            }
            
            selectedWork.history.push({
                workers: Utils.getWorkersInfo().all,
                mainWorker: currentWorker,
                subWorkers: subWorkers.slice(),
                startTime: workStartTime,
                endTime: workEndTime,
                production: pauseQty,
                reason: PAUSE_REASONS[reason] || reason,
                type: 'pause',
                memo: memo,
                isTwoPersonWork: isTwoPersonWork,
                lotNumber: currentLotNumber,
                moldNumber: currentMoldNumber,
                startChecklist: startChecklist,
                firstProductInspection: firstProductInspection
            });
            
            // ëˆ„ì  ìƒì‚°ëŸ‰ ì—…ë°ì´íŠ¸
            selectedWork.actualQty += pauseQty;
            totalProduction += pauseQty;
            
            // ìƒíƒœ ë³€ê²½
            selectedWork.status = 'paused';
            workStatus = 'idle';
            
            // UI ì´ˆê¸°í™”
            workStartTime = null;
            Utils.setButtonState('startBtn', false);
            Utils.setButtonState('stopBtn', false);
            Utils.setButtonState('resumeBtn', false);
            Utils.setButtonState('pauseBtn', false);
            Utils.setButtonState('endBtn', false);
            Utils.setButtonState('resumeWorkBtn', false);
            Utils.setElementText('currentWork', '');
            Utils.setElementText('previousProduction', '');
            Utils.setElementText('workTime', '00:00');
            
            Utils.hideModal('pauseWorkModal');
            
            loadWorkList();
            updateKPI();
            
            var alertMsg = 'ì‘ì—…ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì‚°ëŸ‰: ' + pauseQty + 'm (ëˆ„ì : ' + selectedWork.actualQty + 'm)';
            if (isTwoPersonWork) {
                alertMsg += '\nì°¸ì—¬ì: ' + Utils.getWorkersInfo().display;
            }
            if (memo) {
                alertMsg += '\nì¸ìˆ˜ì¸ê³„ ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
            }
            Utils.showAlert(alertMsg);
            
            selectedWork = null;
        }
        
        // ì‘ì—… ì¤‘ë‹¨ ì·¨ì†Œ
        function cancelPauseWork() {
            Utils.hideModal('pauseWorkModal');
        }
        
        // ì¤‘ë‹¨ëœ ì‘ì—… ì¬ê°œ
        function resumePausedWork() {
            if (!selectedWork || selectedWork.status !== 'paused') {
                Utils.showAlert('ì¤‘ë‹¨ëœ ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            // LOT ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
            showLotModal();
        }
        
        // ì‘ì—… ì¢…ë£Œ ëª¨ë‹¬ í‘œì‹œ
        function showEndWorkModal() {
            Utils.showModal('endWorkModal');
            Utils.setElementValue('goodQty', '');
            document.getElementById('goodQty').focus();
        }
        
        // ì‘ì—… ì¢…ë£Œ í™•ì¸
        function confirmEndWork() {
            var goodQty = Utils.getElementValue('goodQty');
            
            if (!goodQty || goodQty <= 0) {
                Utils.showAlert('ì–‘í’ˆ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            goodQty = parseFloat(goodQty);
            var workEndTime = new Date();
            
            // ì‘ì—… ì´ë ¥ ì¶”ê°€
            if (!selectedWork.history) {
                selectedWork.history = [];
            }
            
            selectedWork.history.push({
                workers: Utils.getWorkersInfo().all,
                mainWorker: currentWorker,
                subWorkers: subWorkers.slice(),
                startTime: workStartTime,
                endTime: workEndTime,
                production: goodQty,
                type: 'complete',
                isTwoPersonWork: isTwoPersonWork,
                lotNumber: currentLotNumber,
                moldNumber: currentMoldNumber,
                startChecklist: startChecklist,
                firstProductInspection: firstProductInspection
            });
            
            // ìµœì¢… ìƒì‚°ëŸ‰
            selectedWork.actualQty += goodQty;
            selectedWork.status = 'completed';
            totalProduction += goodQty;
            
            var finalActualQty = selectedWork.actualQty;
            
            workStartTime = null;
            workStatus = 'idle';
            selectedWork = null;
            totalStopTime = 0;
            
            Utils.setButtonState('startBtn', false);
            Utils.setButtonState('stopBtn', false);
            Utils.setButtonState('resumeBtn', false);
            Utils.setButtonState('pauseBtn', false);
            Utils.setButtonState('endBtn', false);
            Utils.setButtonState('resumeWorkBtn', false);
            Utils.setElementText('currentWork', '');
            Utils.setElementText('previousProduction', '');
            Utils.setElementText('workTime', '00:00');
            
            Utils.hideModal('endWorkModal');
            
            loadWorkList();
            updateKPI();
            
            var alertMsg = 'ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë²ˆ ìƒì‚°ëŸ‰: ' + goodQty + 'm (ì´ ìƒì‚°ëŸ‰: ' + finalActualQty + 'm)';
            if (isTwoPersonWork) {
                alertMsg += '\nì°¸ì—¬ì: ' + Utils.getWorkersInfo().display;
            }
            Utils.showAlert(alertMsg);
        }
        
        // ì‘ì—… ì¢…ë£Œ ì·¨ì†Œ
        function cancelEndWork() {
            Utils.hideModal('endWorkModal');
        }
        
        // ë¶ˆëŸ‰ ì €ì¥
        function saveDefect() {
            var qty = Utils.getElementValue('defectQty');
            var type = Utils.getElementValue('defectType');
            
            if (!qty || !type) {
                Utils.showAlert('ë¶ˆëŸ‰ ìˆ˜ëŸ‰ê³¼ ìœ í˜•ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            var defect = {
                time: Utils.formatTime(new Date()),
                qty: parseFloat(qty),
                type: type,
                typeText: DEFECT_TYPES[type] || type,
                workers: Utils.getWorkersInfo().all,
                machine: currentMachine
            };
            
            defectRecords.push(defect);
            
            updateDefectList();
            updateKPI();
            
            Utils.showAlert('ë¶ˆëŸ‰ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            Utils.setElementValue('defectQty', '');
            Utils.setElementValue('defectType', '');
        }
        
        // ë¶ˆëŸ‰ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateDefectList() {
            var listDiv = document.getElementById('defectList');
            var summaryEl = document.getElementById('defectSummary');
            
            if (defectRecords.length === 0) {
                listDiv.innerHTML = 'ì•„ì§ ê¸°ë¡ëœ ë¶ˆëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.';
                summaryEl.textContent = '';
                return;
            }
            
            // ìš”ì•½ ì •ë³´ ê³„ì‚°
            var totalQty = defectRecords.reduce(function(sum, d) { return sum + d.qty; }, 0);
            var detailedCount = defectRecords.filter(function(d) { return d.isDetailed; }).length;
            var simpleCount = defectRecords.length - detailedCount;
            
            summaryEl.textContent = `(ì´ ${defectRecords.length}ê±´, ${totalQty}m - ìƒì„¸ë¶„ì„: ${detailedCount}ê±´, ì¼ë°˜ê¸°ë¡: ${simpleCount}ê±´)`;
            
            listDiv.innerHTML = '';
            
            // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬
            var sortedDefects = defectRecords.slice().reverse();
            
            sortedDefects.forEach(function(defect, index) {
                var div = document.createElement('div');
                div.className = 'defect-item';
                
                var workersInfo = defect.workers && defect.workers.length > 1 ? 
                    ' (' + defect.workers.join(', ') + ')' : ' (' + defect.workers[0] + ')';
                
                var defectTypeDisplay = defect.typeText || DEFECT_TYPES[defect.type] || defect.type;
                
                // ìƒì„¸ ë¶„ì„ëœ ë¶ˆëŸ‰ì¸ ê²½ìš°
                if (defect.isDetailed) {
                    var detailedRecord = detailedDefectRecords.find(function(d) { return d.id === defect.detailId; });
                    
                    div.style.borderLeft = '4px solid #ef4444';
                    div.style.background = '#fef2f2';
                    
                    var contextInfo = '';
                    if (detailedRecord && detailedRecord.workContext) {
                        contextInfo = `<br><span style="font-size: 11px; color: #666;">
                            ì‘ì—…: ${detailedRecord.workContext.workNo || '-'} | 
                            LOT: ${detailedRecord.workContext.lotNumber || '-'} | 
                            ì§„í–‰ë¥ : ${detailedRecord.workContext.currentProgress || 0}m
                        </span>`;
                    }
                    
                    var causeInfo = detailedRecord ? 
                        `<br><span style="font-size: 11px; color: #ef4444;">ì›ì¸: ${detailedRecord.cause}</span>` : '';
                    
                    div.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                            <span style="background: #ef4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; font-weight: bold;">ìƒì„¸ë¶„ì„</span>
                            <span style="font-weight: bold;">${defect.time} - ${defect.qty}m (${defectTypeDisplay})${workersInfo}</span>
                        </div>
                        ${contextInfo}
                        ${causeInfo}
                        <button onclick="showDefectDetail(${defect.detailId})" style="margin-top: 8px; padding: 4px 8px; background: #3b82f6; color: white; border: none; border-radius: 4px; font-size: 11px; cursor: pointer;">
                            ğŸ“‹ ìƒì„¸ë³´ê¸°
                        </button>
                    `;
                } else {
                    // ì¼ë°˜ ë¶ˆëŸ‰ ê¸°ë¡
                    div.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="background: #6b7280; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px;">ì¼ë°˜ê¸°ë¡</span>
                            <span>${defect.time} - ${defect.qty}m (${defectTypeDisplay})${workersInfo}</span>
                        </div>
                    `;
                }
                
                listDiv.appendChild(div);
            });
        }
        
        // KPI ì—…ë°ì´íŠ¸
        function updateKPI() {
            // ì´ ìƒì‚°ëŸ‰ (ìˆ˜ì •ëŸ‰ í¬í•¨)
            var adjustedTotalProduction = totalProduction;
            var works = workOrders[currentMachine] || [];
            works.forEach(function(work) {
                if (work.correction) {
                    adjustedTotalProduction += work.correction.adjustedQty;
                }
            });
            
            Utils.setElementText('totalProduction', adjustedTotalProduction + 'm');
            
            // ë‹¬ì„±ë¥  ê³„ì‚°
            var totalTargetQty = 0;
            var totalActualQty = 0;
            
            works.forEach(function(work) {
                totalTargetQty += work.targetQty;
                var workActualQty = work.actualQty + (work.correction ? work.correction.adjustedQty : 0);
                totalActualQty += workActualQty;
            });
            
            var achievementRate = totalTargetQty > 0 ? 
                (totalActualQty / totalTargetQty * 100).toFixed(1) : 0;
            
            Utils.setElementText('achievementRate', achievementRate + '%');
            
            // ë‹¬ì„±ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            var achievementElement = document.getElementById('achievementRate');
            if (achievementRate >= 100) {
                achievementElement.style.color = '#10b981';
            } else if (achievementRate >= 80) {
                achievementElement.style.color = '#1e3a8a';
            } else if (achievementRate >= 60) {
                achievementElement.style.color = '#f59e0b';
            } else {
                achievementElement.style.color = '#ef4444';
            }
            
            // ë¶ˆëŸ‰ë¥  ê³„ì‚°
            var totalDefects = defectRecords.reduce(function(sum, d) { return sum + d.qty; }, 0);
            var defectRate = adjustedTotalProduction > 0 ? 
                (totalDefects / (adjustedTotalProduction + totalDefects) * 100).toFixed(1) : 0;
            Utils.setElementText('defectRate', defectRate + '%');
            
            // ë¶ˆëŸ‰ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            var defectElement = document.getElementById('defectRate');
            if (defectRate >= 5) {
                defectElement.style.color = '#ef4444';
            } else if (defectRate >= 3) {
                defectElement.style.color = '#f59e0b';
            } else {
                defectElement.style.color = '#10b981';
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (Utils.confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                clearInterval(timerInterval);
                
                // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
                currentWorker = '';
                currentMachine = '';
                subWorkers = [];
                isTwoPersonWork = false;
                selectedWork = null;
                workStartTime = null;
                workStatus = 'idle';
                stopStartTime = null;
                totalStopTime = 0;
                defectRecords = [];
                totalProduction = 0;
                independentStopStartTime = null;
                isIndependentStop = false;
                stopLog = [];
                dailySafetyChecked = false;
                
                // í™”ë©´ ì „í™˜
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainScreen').classList.add('hidden');
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                Utils.setElementValue('workerName', '');
                Utils.setElementValue('machineNo', '');
                document.getElementById('twoPersonWork').checked = false;
                Utils.hideElement('subWorkerSection');
            }
        }
        
        // ì„¤ë¹„ ì •ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateStopLogList() {
            var listDiv = document.getElementById('stopLogList');
            if (stopLog.length === 0) {
                listDiv.innerHTML = 'ì•„ì§ ì„¤ë¹„ ì •ì§€ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }
            
            listDiv.innerHTML = '';
            stopLog.forEach(function(stop) {
                if (stop.endTime) {
                    var durationMs = stop.endTime - stop.startTime;
                    var durationText = Utils.formatDuration(durationMs);
                    
                    var workersInfo = stop.workers && stop.workers.length > 1 ? 
                        ' (' + stop.workers.join(', ') + ')' : ' (' + stop.workers[0] + ')';
                    
                    var div = document.createElement('div');
                    div.className = 'defect-item';
                    div.innerHTML = Utils.formatTime(stop.startTime) + ' - ' + 
                                   stop.reasonText + ' (' + durationText + ') - ' + 
                                   stop.workNo + workersInfo;
                    listDiv.appendChild(div);
                }
            });
        }
        
        // ë…ë¦½ ì„¤ë¹„ ì •ì§€ ëª¨ë‹¬ í‘œì‹œ
        function showIndependentStopModal() {
            if (isIndependentStop) {
                Utils.showAlert('ì´ë¯¸ ì„¤ë¹„ê°€ ì •ì§€ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }
            Utils.showModal('independentStopModal');
            Utils.setElementValue('independentStopReason', '');
        }
        
        // ë…ë¦½ ì„¤ë¹„ ì •ì§€ í™•ì¸
        function confirmIndependentStop() {
            var reason = Utils.getElementValue('independentStopReason');
            if (!reason) {
                Utils.showAlert('ì •ì§€ ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            isIndependentStop = true;
            independentStopStartTime = new Date();
            
            Utils.setButtonState('independentStopBtn', false);
            Utils.setButtonState('independentResumeBtn', true);
            Utils.setElementText('independentStopStatus', 
                'ì„¤ë¹„ ì •ì§€ ì¤‘: ' + (STOP_REASONS[reason] || reason));
            
            Utils.hideModal('independentStopModal');
            Utils.showAlert('ì„¤ë¹„ ì •ì§€ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤: ' + (STOP_REASONS[reason] || reason));
        }
        
        // ë…ë¦½ ì„¤ë¹„ ì •ì§€ ì·¨ì†Œ
        function cancelIndependentStop() {
            Utils.hideModal('independentStopModal');
        }
        
        // ë…ë¦½ ì„¤ë¹„ ì¬ê°€ë™
        function independentResume() {
            if (!isIndependentStop) return;
            
            var stopEndTime = new Date();
            var stopDuration = stopEndTime - independentStopStartTime;
            
            // ì •ì§€ ë¡œê·¸ì— ê¸°ë¡
            stopLog.push({
                reason: 'ë…ë¦½ì •ì§€',
                reasonText: document.getElementById('independentStopStatus').textContent.replace('ì„¤ë¹„ ì •ì§€ ì¤‘: ', ''),
                startTime: independentStopStartTime,
                endTime: stopEndTime,
                duration: stopDuration,
                workers: Utils.getWorkersInfo().all,
                workNo: 'ì‘ì—… ì™¸'
            });
            
            isIndependentStop = false;
            independentStopStartTime = null;
            
            Utils.setButtonState('independentStopBtn', true);
            Utils.setButtonState('independentResumeBtn', false);
            Utils.setElementText('independentStopStatus', '');
            Utils.setElementText('independentStopTime', '');
            
            updateStopLogList();
            
            Utils.showAlert('ì„¤ë¹„ê°€ ì¬ê°€ë™ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì‘ì—… ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        function canCorrectWork(work) {
            if (!work.history || work.history.length === 0) return false;
            
            // ë§ˆì§€ë§‰ ì™„ë£Œ ê¸°ë¡ ì°¾ê¸°
            var lastCompleteHistory = null;
            for (var i = work.history.length - 1; i >= 0; i--) {
                if (work.history[i].type === 'complete') {
                    lastCompleteHistory = work.history[i];
                    break;
                }
            }
            
            if (!lastCompleteHistory) return false;
            
            var now = new Date();
            var timeDiff = now - new Date(lastCompleteHistory.endTime);
            var hoursPassed = timeDiff / (1000 * 60 * 60);
            
            return hoursPassed <= CONFIG.WORK_CORRECTION_TIME_LIMIT_HOURS;
        }
        
        // ì‹¤ì  ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
        function showCorrectionModal(work) {
            correctionWork = work;
            
            Utils.setElementText('correctionWorkName', work.name);
            Utils.setElementText('correctionCurrentQty', work.actualQty);
            Utils.setElementValue('correctionAdjustQty', '');
            Utils.setElementValue('correctionReason', '');
            Utils.hideElement('correctionPreview');
            
            // ìˆ˜ì •ëŸ‰ ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            document.getElementById('correctionAdjustQty').addEventListener('input', updateCorrectionPreview);
            
            Utils.showModal('correctionModal');
        }
        
        // ìˆ˜ì • ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateCorrectionPreview() {
            var adjustQty = parseFloat(Utils.getElementValue('correctionAdjustQty')) || 0;
            var currentQty = correctionWork.actualQty;
            var newQty = currentQty + adjustQty;
            
            if (adjustQty !== 0) {
                var previewText = currentQty + 'm â†’ ' + newQty + 'm (' + 
                    (adjustQty > 0 ? '+' : '') + adjustQty + 'm)';
                Utils.setElementText('correctionPreviewText', previewText);
                Utils.showElement('correctionPreview');
            } else {
                Utils.hideElement('correctionPreview');
            }
        }
        
        // ì‹¤ì  ìˆ˜ì • í™•ì¸
        function confirmCorrection() {
            var adjustQty = parseFloat(Utils.getElementValue('correctionAdjustQty'));
            var reason = Utils.getElementValue('correctionReason');
            
            if (isNaN(adjustQty) || adjustQty === 0) {
                Utils.showAlert('ìˆ˜ì •ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”. (0ì´ ì•„ë‹Œ ê°’)');
                return;
            }
            
            if (!reason) {
                Utils.showAlert('ìˆ˜ì • ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            var newTotal = correctionWork.actualQty + adjustQty;
            if (newTotal < 0) {
                Utils.showAlert('ìˆ˜ì • í›„ ì‹¤ì ì´ ìŒìˆ˜ê°€ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ìˆ˜ì • ì •ë³´ ì €ì¥
            correctionWork.correction = {
                adjustedQty: adjustQty,
                reason: reason,
                correctedBy: currentWorker,
                correctedAt: new Date(),
                originalQty: correctionWork.actualQty
            };
            
            // ì „ì²´ ìƒì‚°ëŸ‰ì— ë°˜ì˜
            totalProduction += adjustQty;
            
            // UI ì—…ë°ì´íŠ¸
            loadWorkList();
            updateKPI();
            
            Utils.hideModal('correctionModal');
            
            Utils.showAlert('ì‹¤ì ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n' + 
                  correctionWork.actualQty + 'm â†’ ' + newTotal + 'm (' + 
                  (adjustQty > 0 ? '+' : '') + adjustQty + 'm)');
            
            correctionWork = null;
        }
        
        // ì‹¤ì  ìˆ˜ì • ì·¨ì†Œ
        function cancelCorrection() {
            Utils.hideModal('correctionModal');
            correctionWork = null;
        }
        
        // LOT ëª¨ë‹¬ í‘œì‹œ
        function showLotModal() {
            Utils.showModal('lotModal');
            Utils.setElementValue('lotSelect', '');
            Utils.setElementValue('manualLot', '');
            Utils.hideElement('manualLotInput');
            Utils.setElementValue('moldSelect', '');
            Utils.setElementValue('manualMold', '');
            Utils.hideElement('manualMoldInput');
            document.getElementById('sameLotCheck').checked = false;
            
            // ì´ì „ ì •ë³´ í‘œì‹œ
            if (previousLotNumber || previousMoldNumber) {
                if (previousLotNumber) {
                    Utils.setElementText('previousLotInfo', 'ì´ì „ LOT: ' + previousLotNumber);
                }
                if (previousMoldNumber) {
                    Utils.setElementText('previousMoldInfo', 'ì´ì „ ê¸ˆí˜•: ' + previousMoldNumber);
                }
                Utils.showElement('previousInfo');
            } else {
                Utils.hideElement('previousInfo');
            }
        }
        
        // LOT ì„ íƒ ì²˜ë¦¬
        function handleLotSelect() {
            var select = Utils.getElementValue('lotSelect');
            
            if (select === 'manual') {
                Utils.showElement('manualLotInput');
                document.getElementById('manualLot').focus();
            } else {
                Utils.hideElement('manualLotInput');
            }
        }
        
        // ê¸ˆí˜• ì„ íƒ ì²˜ë¦¬
        function handleMoldSelect() {
            var select = Utils.getElementValue('moldSelect');
            
            if (select === 'manual') {
                Utils.showElement('manualMoldInput');
                document.getElementById('manualMold').focus();
            } else {
                Utils.hideElement('manualMoldInput');
            }
        }
        
        // ë™ì¼ ì„¤ì • ì²´í¬ ì²˜ë¦¬
        function handleSameLot() {
            var checkbox = document.getElementById('sameLotCheck');
            var lotSelect = document.getElementById('lotSelect');
            var moldSelect = document.getElementById('moldSelect');
            
            if (checkbox.checked && (previousLotNumber || previousMoldNumber)) {
                lotSelect.disabled = true;
                moldSelect.disabled = true;
                Utils.hideElement('manualLotInput');
                Utils.hideElement('manualMoldInput');
            } else {
                lotSelect.disabled = false;
                moldSelect.disabled = false;
            }
        }
        
        // LOT í™•ì¸
        function confirmLot() {
            var lotNumber = '';
            var moldNumber = '';
            var checkbox = document.getElementById('sameLotCheck');
            
            if (checkbox.checked && (previousLotNumber || previousMoldNumber)) {
                lotNumber = previousLotNumber;
                moldNumber = previousMoldNumber;
            } else {
                // LOT ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                var lotSelect = Utils.getElementValue('lotSelect');
                if (lotSelect === 'manual') {
                    lotNumber = Utils.getElementValue('manualLot').trim();
                } else {
                    lotNumber = lotSelect;
                }
                
                // ê¸ˆí˜• ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                var moldSelect = Utils.getElementValue('moldSelect');
                if (moldSelect === 'manual') {
                    moldNumber = Utils.getElementValue('manualMold').trim();
                } else {
                    moldNumber = moldSelect;
                }
            }
            
            if (!lotNumber) {
                Utils.showAlert('LOT ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!moldNumber) {
                Utils.showAlert('ê¸ˆí˜• ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            // LOT ë³€ê²½ ì—¬ë¶€ í™•ì¸
            isLotChanged = (previousLotNumber && previousLotNumber !== lotNumber);
            
            currentLotNumber = lotNumber;
            currentMoldNumber = moldNumber;
            previousLotNumber = lotNumber;
            previousMoldNumber = moldNumber;
            
            Utils.hideModal('lotModal');
            
            // ì‹œì‘ ì ê²€ ëª¨ë‹¬ í‘œì‹œ
            showChecklistModal();
        }
        
        // LOT ì·¨ì†Œ
        function cancelLot() {
            Utils.hideModal('lotModal');
        }
        
        // ì‹œì‘ ì ê²€ ëª¨ë‹¬ í‘œì‹œ
        function showChecklistModal() {
            Utils.showModal('checklistModal');
            
            // ì‘ì—… ì •ë³´ í‘œì‹œ
            Utils.setElementText('checklistWorkNo', selectedWork.name);
            
            // ì‘ì—…ë³„ íŠ¹í™” ì•ˆì „ì‚¬í•­ ì„¤ì •
            setWorkSpecificSafety();
            
            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            for (var i = 1; i <= CONFIG.CHECKLIST_ITEMS_COUNT; i++) {
                document.getElementById('check' + i).checked = false;
            }
            
            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            Utils.setButtonState('checklistConfirmBtn', false);
            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            for (var i = 1; i <= CONFIG.CHECKLIST_ITEMS_COUNT; i++) {
                document.getElementById('check' + i).addEventListener('change', updateChecklistButton);
            }
        }
        
        // ì‘ì—…ë³„ íŠ¹í™” ì•ˆì „ì‚¬í•­ ì„¤ì •
        function setWorkSpecificSafety() {
            var safetyText = '';
            
            if (isTwoPersonWork) {
                safetyText = '2ì¸ ì‘ì—… - í˜‘ì—… ì‹ í˜¸ ë° ì—­í•  ë¶„ë‹´ í™•ì¸';
            } else if (selectedWork.product === 'M-BAR-KS') {
                safetyText = 'M-BAR ì‘ì—… - ëŒ€í˜• ì œí’ˆ ì·¨ê¸‰ ì‹œ ì£¼ì˜';
            } else if (selectedWork.product === 'RUNNER 30') {
                safetyText = 'RUNNER ì‘ì—… - ì ˆë‹¨ë©´ ë‚ ì¹´ë¡œì›€ ì£¼ì˜';
            } else if (selectedWork.product === 'STUD') {
                safetyText = 'STUD ì‘ì—… - ëŒì¶œë¶€ ì°”ë¦¼ ì£¼ì˜';
            } else {
                safetyText = 'í•´ë‹¹ ì œí’ˆì˜ ì•ˆì „ ì£¼ì˜ì‚¬í•­ í™•ì¸';
            }
            
            Utils.setElementText('workSpecificSafety', safetyText);
        }
        
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateChecklistButton() {
            var allChecked = true;
            for (var i = 1; i <= CONFIG.CHECKLIST_ITEMS_COUNT; i++) {
                if (!document.getElementById('check' + i).checked) {
                    allChecked = false;
                    break;
                }
            }
            Utils.setButtonState('checklistConfirmBtn', allChecked);
        }
        
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸
        function confirmChecklist() {
            // ì ê²€ ê²°ê³¼ ì €ì¥
            startChecklist = {
                equipmentCheck: document.getElementById('check1').checked,
                moldCheck: document.getElementById('check2').checked,
                materialCheck: document.getElementById('check3').checked,
                safetyEquipmentCheck: document.getElementById('check4').checked,
                workAreaSafetyCheck: document.getElementById('check7').checked,
                workSpecificSafetyCheck: document.getElementById('check8').checked,
                instructionCheck: document.getElementById('check5').checked,
                handoverCheck: document.getElementById('check6').checked,
                checkTime: new Date(),
                checkedBy: currentWorker,
                workNo: selectedWork.name,
                isTwoPersonWork: isTwoPersonWork,
                participants: Utils.getWorkersInfo().all
            };
            
            Utils.hideModal('checklistModal');
            
            // ì´ˆí’ˆê²€ì‚¬ ëª¨ë‹¬ í‘œì‹œ
            showFirstProductModal();
        }
        
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ê±´ë„ˆë›°ê¸°
        function skipChecklist() {
            if (Utils.confirm('ì ê²€ì„ ê±´ë„ˆë›°ì‹œê² ìŠµë‹ˆê¹Œ?\nì•ˆì „ì„ ìœ„í•´ ì ê²€ì„ ê¶Œì¥í•©ë‹ˆë‹¤.')) {
                startChecklist = {
                    skipped: true,
                    skipTime: new Date(),
                    skipBy: currentWorker
                };
                
                Utils.hideModal('checklistModal');
                
                // ì´ˆí’ˆê²€ì‚¬ ëª¨ë‹¬ í‘œì‹œ
                showFirstProductModal();
            }
        }
        
        // ì´ˆí’ˆê²€ì‚¬ ëª¨ë‹¬ í‘œì‹œ
        function showFirstProductModal() {
            Utils.showModal('firstProductModal');
            
            // ì‘ì—… ì •ë³´ í‘œì‹œ
            Utils.setElementText('inspectionWorkNo', selectedWork.name);
            Utils.setElementText('inspectionProduct', selectedWork.product);
            
            // ê²½ê³  ì˜ì—­ ì´ˆê¸°í™”
            Utils.setElementHtml('inspectionWarningArea', '');
            
            // ê²€ì‚¬ ê·¸ë¦¬ë“œ ìƒì„±
            generateInspectionGrid();
            
            // ì§„í–‰ë¥  ì´ˆê¸°í™”
            updateInspectionProgress();
        }
        
        // ê²€ì‚¬ ê·¸ë¦¬ë“œ ìƒì„±
        function generateInspectionGrid() {
            var grid = document.getElementById('inspectionGrid');
            grid.innerHTML = '';
            
            var criteria = productCriteria[selectedWork.product];
            if (!criteria) {
                Utils.showAlert('ì œí’ˆ ê²€ì‚¬ ê¸°ì¤€ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì´ˆê¸°í™”
            firstProductInspection = {
                products: [],
                startTime: new Date(),
                inspector: currentWorker,
                workNo: selectedWork.name,
                product: selectedWork.product,
                skipped: false,
                retryCount: inspectionRetryCount
            };
            
            // ë¶ˆí•©ê²© ìƒíƒœ ì´ˆê¸°í™”
            hasFailedInspection = false;
            
            // 3ê°œ ì œí’ˆ ê²€ì‚¬ ì¹´ë“œ ìƒì„±
            for (var i = 1; i <= CONFIG.INSPECTION_PRODUCTS_COUNT; i++) {
                var productCard = document.createElement('div');
                productCard.className = 'product-inspection';
                productCard.id = 'product' + i;
                
                productCard.innerHTML = `
                    <h4>ì œí’ˆ ${i}</h4>
                    <div class="inspection-items">
                        <div class="inspection-item">
                            <span class="inspection-label">ê¸¸ì´</span>
                            <div class="inspection-buttons">
                                <button class="inspection-btn pass" onclick="setInspectionResult(${i}, 'length', 'pass')">í•©ê²©</button>
                                <button class="inspection-btn fail" onclick="setInspectionResult(${i}, 'length', 'fail')">ë¶ˆí•©ê²©</button>
                            </div>
                        </div>
                        <div class="inspection-item">
                            <span class="inspection-label">í­</span>
                            <div class="inspection-buttons">
                                <button class="inspection-btn pass" onclick="setInspectionResult(${i}, 'width', 'pass')">í•©ê²©</button>
                                <button class="inspection-btn fail" onclick="setInspectionResult(${i}, 'width', 'fail')">ë¶ˆí•©ê²©</button>
                            </div>
                        </div>
                        <div class="inspection-item">
                            <span class="inspection-label">ê°€ë¡œêµ½í˜</span>
                            <div class="inspection-buttons">
                                <button class="inspection-btn pass" onclick="setInspectionResult(${i}, 'bend', 'pass')">í•©ê²©</button>
                                <button class="inspection-btn fail" onclick="setInspectionResult(${i}, 'bend', 'fail')">ë¶ˆí•©ê²©</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-criteria">
                        <strong>ê²€ì‚¬ê¸°ì¤€:</strong><br>
                        ê¸¸ì´: ${criteria.length.min}-${criteria.length.max}${criteria.length.unit}<br>
                        í­: ${criteria.width.min}-${criteria.width.max}${criteria.width.unit}<br>
                        ê°€ë¡œêµ½í˜: â‰¤${criteria.bend.max}${criteria.bend.unit}
                    </div>
                `;
                
                grid.appendChild(productCard);
                
                // ì œí’ˆë³„ ê²€ì‚¬ ê²°ê³¼ ì´ˆê¸°í™”
                firstProductInspection.products[i-1] = {
                    productNo: i,
                    length: null,
                    width: null,
                    bend: null,
                    overallResult: null
                };
            }
        }
        
        // ê²€ì‚¬ ê²°ê³¼ ì„¤ì •
        function setInspectionResult(productNo, item, result) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            var productCard = document.getElementById('product' + productNo);
            var buttons = productCard.querySelectorAll('.inspection-item .inspection-btn');
            
            // í•´ë‹¹ í•­ëª©ì˜ ë²„íŠ¼ë“¤ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            var itemButtons = productCard.querySelectorAll('.inspection-item:nth-child(' + getItemIndex(item) + ') .inspection-btn');
            itemButtons.forEach(function(btn) {
                btn.classList.remove('selected');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ì— selected í´ë˜ìŠ¤ ì¶”ê°€
            event.target.classList.add('selected');
            
            // ê²°ê³¼ ì €ì¥
            firstProductInspection.products[productNo-1][item] = result;
            
            // ë¶ˆí•©ê²© ì¦‰ì‹œ ë°˜ì‘
            if (result === 'fail') {
                hasFailedInspection = true;
                showInspectionWarning();
            }
            
            // ì œí’ˆë³„ ì „ì²´ ê²°ê³¼ í™•ì¸
            checkProductCompletion(productNo);
            
            // ì „ì²´ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            updateInspectionProgress();
        }
        
        // ê²€ì‚¬ ê²½ê³  í‘œì‹œ
        function showInspectionWarning() {
            var warningArea = document.getElementById('inspectionWarningArea');
            if (hasFailedInspection) {
                warningArea.innerHTML = `
                    <div class="inspection-warning">
                        ğŸš« ë¶ˆí•©ê²© ì œí’ˆì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                        ëª¨ë“  ê²€ì‚¬ ì™„ë£Œ í›„ ì„¤ë¹„ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                `;
            } else {
                warningArea.innerHTML = '';
            }
        }
        
        // í•­ëª© ì¸ë±ìŠ¤ ë°˜í™˜
        function getItemIndex(item) {
            switch(item) {
                case 'length': return 1;
                case 'width': return 2;
                case 'bend': return 3;
                default: return 1;
            }
        }
        
        // ì œí’ˆ ê²€ì‚¬ ì™„ë£Œ í™•ì¸
        function checkProductCompletion(productNo) {
            var product = firstProductInspection.products[productNo-1];
            var productCard = document.getElementById('product' + productNo);
            
            // ëª¨ë“  í•­ëª©ì´ ê²€ì‚¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (product.length !== null && product.width !== null && product.bend !== null) {
                // ì „ì²´ ê²°ê³¼ íŒì •
                var hasFailure = product.length === 'fail' || product.width === 'fail' || product.bend === 'fail';
                product.overallResult = hasFailure ? 'fail' : 'pass';
                
                // ì¹´ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½
                productCard.classList.remove('completed', 'failed');
                if (hasFailure) {
                    productCard.classList.add('failed');
                } else {
                    productCard.classList.add('completed');
                }
            }
        }
        
        // ê²€ì‚¬ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateInspectionProgress() {
            var completedProducts = 0;
            
            for (var i = 0; i < CONFIG.INSPECTION_PRODUCTS_COUNT; i++) {
                var product = firstProductInspection.products[i];
                if (product.length !== null && product.width !== null && product.bend !== null) {
                    completedProducts++;
                }
            }
            
            Utils.setElementText('inspectionProgress', 
                'ê²€ì‚¬ ì§„í–‰ë¥ : ' + completedProducts + '/' + CONFIG.INSPECTION_PRODUCTS_COUNT + ' ì™„ë£Œ');
            
            // ëª¨ë“  ê²€ì‚¬ ì™„ë£Œ ì‹œ ë²„íŠ¼ í™œì„±í™”
            var completeBtn = document.getElementById('completeInspectionBtn');
            if (completedProducts === CONFIG.INSPECTION_PRODUCTS_COUNT) {
                completeBtn.disabled = false;
                if (hasFailedInspection) {
                    completeBtn.textContent = 'âŒ ê²€ì‚¬ ì™„ë£Œ (ë¶ˆí•©ê²© ìˆìŒ)';
                    completeBtn.style.background = '#ef4444';
                } else {
                    completeBtn.textContent = 'âœ… ê²€ì‚¬ ì™„ë£Œ - ì‘ì—… ì‹œì‘';
                    completeBtn.style.background = '#10b981';
                }
            } else {
                completeBtn.disabled = true;
                completeBtn.textContent = 'âœ… ê²€ì‚¬ ì™„ë£Œ - ì‘ì—… ì‹œì‘';
                completeBtn.style.background = '#6b7280';
            }
        }
        
        // ê²€ì‚¬ ì™„ë£Œ
        function completeInspection() {
            // ë¶ˆí•©ê²© ì œí’ˆ ìˆ˜ í™•ì¸
            var failedProducts = firstProductInspection.products.filter(function(p) {
                return p.overallResult === 'fail';
            }).length;
            
            // ê²€ì‚¬ ì™„ë£Œ ì‹œê°„ ê¸°ë¡
            firstProductInspection.endTime = new Date();
            firstProductInspection.failedCount = failedProducts;
            firstProductInspection.passedCount = CONFIG.INSPECTION_PRODUCTS_COUNT - failedProducts;
            firstProductInspection.retryCount = inspectionRetryCount;
            
            // ë¶ˆí•©ê²©ì´ í•˜ë‚˜ë¼ë„ ìˆëŠ” ê²½ìš°
            if (failedProducts > 0) {
                Utils.hideModal('firstProductModal');
                showInspectionFailedModal(failedProducts);
                return;
            }
            
            // ëª¨ë“  ì œí’ˆ í•©ê²© ì‹œ
            Utils.showAlert('ì´ˆí’ˆê²€ì‚¬ ì™„ë£Œ!\nëª¨ë“  ì œí’ˆì´ í•©ê²©í•˜ì˜€ìŠµë‹ˆë‹¤. ë³¸ìƒì‚°ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
            Utils.hideModal('firstProductModal');
            actualStartWork();
        }
        
        // ê²€ì‚¬ ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
        function showInspectionFailedModal(failedCount) {
            var passedCount = CONFIG.INSPECTION_PRODUCTS_COUNT - failedCount;
            
            // ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            Utils.setElementText('failedResultText', 
                'í•©ê²© ' + passedCount + 'ê°œ, ë¶ˆí•©ê²© ' + failedCount + 'ê°œ');
            
            // ì¬ê²€ì‚¬ íšŸìˆ˜ í‘œì‹œ
            if (inspectionRetryCount > 0) {
                document.getElementById('retryWarning').classList.remove('hidden');
                Utils.setElementText('retryCount', inspectionRetryCount);
            } else {
                document.getElementById('retryWarning').classList.add('hidden');
            }
            
            // 3íšŒ ì´ˆê³¼ ì‹œ ì¬ê²€ì‚¬ ë²„íŠ¼ ë¹„í™œì„±í™”
            var retryBtn = document.querySelector('.btn-retry');
            if (inspectionRetryCount >= CONFIG.INSPECTION_MAX_RETRY_COUNT) {
                retryBtn.disabled = true;
                retryBtn.textContent = 'âŒ ì¬ê²€ì‚¬ ë¶ˆê°€ (ê´€ë¦¬ì í˜¸ì¶œ í•„ìš”)';
                retryBtn.style.background = '#6b7280';
            } else {
                retryBtn.disabled = false;
                retryBtn.textContent = 'ğŸ”„ ì¬ê²€ì‚¬ ì‹¤ì‹œ';
                retryBtn.style.background = '#f59e0b';
            }
            
            Utils.showModal('inspectionFailedModal');
        }
        
        // ì¬ê²€ì‚¬ ì‹¤ì‹œ
        function retryInspection() {
            if (inspectionRetryCount >= CONFIG.INSPECTION_MAX_RETRY_COUNT) {
                Utils.showAlert('ì¬ê²€ì‚¬ íšŸìˆ˜ê°€ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                return;
            }
            
            inspectionRetryCount++;
            
            // ì‹¤íŒ¨ ëª¨ë‹¬ ë‹«ê¸°
            Utils.hideModal('inspectionFailedModal');
            
            // ê²€ì‚¬ ë°ì´í„° ì´ˆê¸°í™”
            hasFailedInspection = false;
            
            // ê²€ì‚¬ ëª¨ë‹¬ ë‹¤ì‹œ í‘œì‹œ
            showFirstProductModal();
            
            Utils.showAlert('ì¬ê²€ì‚¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.\nìƒˆë¡œìš´ 3ê°œ ì œí’ˆì„ ê²€ì‚¬í•´ì£¼ì„¸ìš”. (ì¬ê²€ì‚¬ ' + inspectionRetryCount + 'íšŒì°¨)');
        }
        
        // ì„¤ë¹„ì ê²€ ìš”ì²­
        function requestMaintenance() {
            var maintenanceRequest = {
                time: new Date(),
                worker: currentWorker,
                machine: currentMachine,
                workNo: selectedWork.name,
                product: selectedWork.product,
                reason: 'ì´ˆí’ˆê²€ì‚¬ ë¶ˆí•©ê²©',
                failedCount: firstProductInspection.failedCount,
                retryCount: inspectionRetryCount,
                lotNumber: currentLotNumber,
                moldNumber: currentMoldNumber
            };
            
            // ì‹¤ì œë¡œëŠ” ê´€ë¦¬ì ì‹œìŠ¤í…œì— ì•Œë¦¼ ì „ì†¡
            console.log('ì„¤ë¹„ì ê²€ ìš”ì²­:', maintenanceRequest);
            
            Utils.hideModal('inspectionFailedModal');
            
            Utils.showAlert('ì„¤ë¹„ì ê²€ ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ìê°€ í™•ì¸ í›„ ì¡°ì¹˜í•  ì˜ˆì •ì…ë‹ˆë‹¤.\n\nìš”ì²­ ë‚´ìš©:\n- í˜¸ê¸°: ' + currentMachine + 'í˜¸ê¸°\n- ì‘ì—…ì: ' + currentWorker + 
                  '\n- ë¶ˆí•©ê²© ê°œìˆ˜: ' + firstProductInspection.failedCount + 'ê°œ\n- ì¬ê²€ì‚¬ íšŸìˆ˜: ' + inspectionRetryCount + 'íšŒ');
            
            // ì‘ì—… ì„ íƒ í•´ì œ ë° ì´ˆê¸°í™”
            selectedWork = null;
            Utils.setElementText('currentWork', '');
            Utils.setButtonState('startBtn', false);
            loadWorkList();
        }
        
        // ì‘ì—… ì‹œì‘ ì‹œ ë¶ˆëŸ‰ ì•Œë¦¼ ì„¹ì…˜ í‘œì‹œ
        function actualStartWork() {
            workStartTime = new Date();
            workStatus = 'working';
            selectedWork.status = 'working';
            totalStopTime = 0;
            
            // ë¶ˆëŸ‰ ì•Œë¦¼ ì„¹ì…˜ í‘œì‹œ
            Utils.showElement('defectAlertSection');
            
            Utils.setButtonState('startBtn', false);
            Utils.setButtonState('stopBtn', true);
            Utils.setButtonState('resumeBtn', false);
            Utils.setButtonState('pauseBtn', true);
            Utils.setButtonState('endBtn', true);
            Utils.setButtonState('resumeWorkBtn', false);
            
            // ì´ì „ ìƒì‚°ëŸ‰ í‘œì‹œ
            if (selectedWork.actualQty > 0) {
                Utils.setElementText('previousProduction', 
                    'ì´ì „ ìƒì‚°ëŸ‰: ' + selectedWork.actualQty + 'm');
            }
            
            // LOT ë° ê¸ˆí˜• ì •ë³´ë„ í•¨ê»˜ í‘œì‹œ
            var workInfo = 'ì‘ì—… ì¤‘: ' + selectedWork.name;
            if (isTwoPersonWork) {
                workInfo += '<br><span style="font-size: 14px; color: #666;">ì°¸ì—¬ì: ' + Utils.getWorkersInfo().display + '</span>';
            }
            workInfo += '<br><span style="font-size: 12px; color: #666;">LOT: ' + currentLotNumber + 
                       ' | ê¸ˆí˜•: ' + currentMoldNumber + '</span>';
            
            Utils.setElementHtml('currentWork', workInfo);
            
            var alertMsg = 'ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤: ' + selectedWork.name + '\nLOT: ' + currentLotNumber + '\nê¸ˆí˜•: ' + currentMoldNumber;
            if (isTwoPersonWork) {
                alertMsg += '\nì°¸ì—¬ì: ' + Utils.getWorkersInfo().display;
            }
            // ì´ˆí’ˆê²€ì‚¬ ê²°ê³¼ ìš”ì•½ ì¶”ê°€
            if (firstProductInspection.failedCount > 0) {
                alertMsg += '\nì´ˆí’ˆê²€ì‚¬: í•©ê²© ' + firstProductInspection.passedCount + 'ê°œ, ë¶ˆí•©ê²© ' + firstProductInspection.failedCount + 'ê°œ';
            } else {
                alertMsg += '\nì´ˆí’ˆê²€ì‚¬: ëª¨ë“  ì œí’ˆ í•©ê²©';
            }
            Utils.showAlert(alertMsg);
        }
        
        // ë¶ˆëŸ‰ ìƒì„¸ ë¶„ì„ ëª¨ë‹¬ í‘œì‹œ
        function showDefectAnalysisModal() {
            Utils.showModal('defectAnalysisModal');
            
            // í˜„ì¬ ì‘ì—… ì •ë³´ ìë™ ì…ë ¥
            updateWorkContext();
            
            // ë¶„ì„ ë‹¨ê³„ ì´ˆê¸°í™”
            resetAnalysisSteps();
            
            // ê³¼ê±° ìœ ì‚¬ ë¶ˆëŸ‰ ê²€ìƒ‰
            searchSimilarDefects();
        }
        
        // í˜„ì¬ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateWorkContext() {
            var now = new Date();
            
            if (selectedWork && workStatus === 'working') {
                Utils.setElementText('contextWorkNo', selectedWork.name);
                Utils.setElementText('contextProduct', selectedWork.product);
                Utils.setElementText('contextLot', currentLotNumber || '-');
                Utils.setElementText('contextMold', currentMoldNumber || '-');
                Utils.setElementText('contextWorkers', Utils.getWorkersInfo().display);
                
                if (workStartTime) {
                    var elapsed = Math.floor((now - workStartTime) / 1000 / 60);
                    Utils.setElementText('contextElapsed', elapsed + 'ë¶„');
                    
                    var progress = selectedWork.actualQty + (selectedWork.correction ? selectedWork.correction.adjustedQty : 0);
                    var progressPercent = selectedWork.targetQty > 0 ? (progress / selectedWork.targetQty * 100).toFixed(1) : 0;
                    Utils.setElementText('contextProgress', progress + 'm (' + progressPercent + '%)');
                } else {
                    Utils.setElementText('contextElapsed', '-');
                    Utils.setElementText('contextProgress', '-');
                }
            } else {
                Utils.setElementText('contextWorkNo', 'ì‘ì—… ì¤‘ì´ ì•„ë‹˜');
                Utils.setElementText('contextProduct', '-');
                Utils.setElementText('contextLot', '-');
                Utils.setElementText('contextMold', '-');
                Utils.setElementText('contextWorkers', currentWorker || '-');
                Utils.setElementText('contextElapsed', '-');
                Utils.setElementText('contextProgress', '-');
            }
            
            Utils.setElementText('contextTime', Utils.formatDateTime(now));
        }
        
        // ë¶„ì„ ë‹¨ê³„ ì´ˆê¸°í™”
        function resetAnalysisSteps() {
            defectAnalysisStep = 1;
            selectedDefectType = '';
            selectedCause = '';
            
            // ëª¨ë“  ë‹¨ê³„ ë¹„í™œì„±í™”
            for (var i = 1; i <= 4; i++) {
                var step = document.getElementById('step' + i);
                step.classList.remove('active', 'completed');
                if (i === 1) step.classList.add('active');
            }
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            Utils.setElementValue('analysisDefectQty', '');
            Utils.setElementValue('defectLocation', '');
            Utils.setElementValue('immediateAction', '');
            Utils.setElementValue('preventionPlan', '');
            Utils.setElementValue('actionOwner', currentWorker);
            
            // ë‚´ì¼ ë‚ ì§œë¡œ ê¸°ë³¸ ì„¤ì •
            var tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('actionDeadline').value = tomorrow.toISOString().split('T')[0];
        }
        
        // ë¶ˆëŸ‰ ìœ í˜• ì„ íƒ
        function selectDefectType(type) {
            selectedDefectType = type;
            
            // ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.defect-type-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // 2ë‹¨ê³„ ì™„ë£Œ í‘œì‹œ
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
            
            // ì›ì¸ ë¶„ì„ íŠ¸ë¦¬ ìƒì„±
            generateCauseTree(type);
            
            defectAnalysisStep = 3;
        }
        
        // ì›ì¸ ë¶„ì„ íŠ¸ë¦¬ ìƒì„±
        function generateCauseTree(defectType) {
            var tree = document.getElementById('causeTree');
            tree.innerHTML = '';
            
            var causes = defectCauses[defectType] || defectCauses['surface'];
            
            Object.keys(causes).forEach(function(category) {
                var categoryDiv = document.createElement('div');
                categoryDiv.className = 'cause-category';
                
                var header = document.createElement('div');
                header.className = 'cause-header';
                header.innerHTML = category + ' <span>â–¼</span>';
                header.onclick = function() {
                    var list = this.nextElementSibling;
                    list.classList.toggle('active');
                    this.querySelector('span').textContent = list.classList.contains('active') ? 'â–²' : 'â–¼';
                };
                
                var list = document.createElement('div');
                list.className = 'cause-list';
                
                causes[category].forEach(function(cause) {
                    var item = document.createElement('div');
                    item.className = 'cause-item';
                    item.textContent = cause;
                    item.onclick = function() {
                        selectCause(category, cause, this);
                    };
                    list.appendChild(item);
                });
                
                categoryDiv.appendChild(header);
                categoryDiv.appendChild(list);
                tree.appendChild(categoryDiv);
            });
        }
        
        // ì›ì¸ ì„ íƒ
        function selectCause(category, cause, element) {
            selectedCause = category + ' > ' + cause;
            
            // ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.cause-item').forEach(function(item) {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // 3ë‹¨ê³„ ì™„ë£Œ í‘œì‹œ
            document.getElementById('step3').classList.add('completed');
            document.getElementById('step3').classList.remove('active');
            document.getElementById('step4').classList.add('active');
            
            // ë¶ˆëŸ‰ ì˜í–¥ë„ í‰ê°€
            evaluateDefectImpact();
            
            defectAnalysisStep = 4;
        }
        
        // ë¶ˆëŸ‰ ì˜í–¥ë„ í‰ê°€
        function evaluateDefectImpact() {
            var qty = parseFloat(Utils.getElementValue('analysisDefectQty')) || 0;
            var impactLevel = 'low';
            var message = '';
            
            // ìˆ˜ëŸ‰ ê¸°ë°˜ ì˜í–¥ë„ í‰ê°€
            if (qty >= 50) {
                impactLevel = 'high';
                message = 'ëŒ€ëŸ‰ ë¶ˆëŸ‰ ë°œìƒ! ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨ ë° ê´€ë¦¬ì ë³´ê³  í•„ìš”';
            } else if (qty >= 20) {
                impactLevel = 'medium';
                message = 'ì¤‘ê°„ ê·œëª¨ ë¶ˆëŸ‰ ë°œìƒ. ì›ì¸ íŒŒì•… ë° ì¡°ì¹˜ í•„ìš”';
            } else if (qty > 0) {
                impactLevel = 'low';
                message = 'ì†ŒëŸ‰ ë¶ˆëŸ‰ ë°œìƒ. ëª¨ë‹ˆí„°ë§ ë° ì˜ˆë°© ì¡°ì¹˜ í•„ìš”';
            }
            
            // ë¶ˆëŸ‰ ìœ í˜•ë³„ ê°€ì¤‘ì¹˜ ì ìš©
            if (selectedDefectType === 'dimension' || selectedDefectType === 'crack') {
                if (impactLevel === 'low') impactLevel = 'medium';
                else if (impactLevel === 'medium') impactLevel = 'high';
            }
            
            // ì˜í–¥ë„ í‘œì‹œ
            var alertDiv = document.getElementById('defectImpactAlert');
            var levelEl = document.getElementById('impactLevel');
            var messageEl = document.getElementById('impactMessage');
            
            levelEl.textContent = impactLevel === 'high' ? 'ë†’ìŒ' : impactLevel === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ';
            levelEl.className = 'impact-level ' + impactLevel;
            messageEl.textContent = message;
            Utils.showElement('defectImpactAlert');
        }
        
        // ê³¼ê±° ìœ ì‚¬ ë¶ˆëŸ‰ ê²€ìƒ‰
        function searchSimilarDefects() {
            // ì‹¤ì œë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²€ìƒ‰
            var similarDefects = [
                {
                    date: '2025-01-20',
                    workNo: '3-0120-01',
                    product: 'M-BAR-KS',
                    type: 'í‘œë©´ë¶ˆëŸ‰',
                    cause: 'ë¡¤ëŸ¬ í‘œë©´ ì†ìƒ',
                    action: 'ë¡¤ëŸ¬ êµì²´',
                    status: 'resolved'
                },
                {
                    date: '2025-01-18',
                    workNo: '3-0118-02',
                    product: 'M-BAR-KS',
                    type: 'í‘œë©´ë¶ˆëŸ‰',
                    cause: 'ìœ¤í™œìœ  ë¶€ì¡±',
                    action: 'ìœ¤í™œìœ  ë³´ì¶© ë° ì ê²€ ì£¼ê¸° ë‹¨ì¶•',
                    status: 'resolved'
                }
            ];
            
            if (similarDefects.length > 0) {
                var historySection = document.getElementById('defectHistorySection');
                var historyDiv = document.getElementById('similarDefectHistory');
                
                historyDiv.innerHTML = '';
                similarDefects.forEach(function(defect) {
                    var item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `
                        <div class="history-header">
                            <strong>${defect.date} - ${defect.workNo}</strong>
                            <span class="history-badge ${defect.status}">${defect.status === 'resolved' ? 'í•´ê²°ë¨' : 'ì§„í–‰ì¤‘'}</span>
                        </div>
                        <div style="font-size: 13px; color: #666;">
                            ë¶ˆëŸ‰: ${defect.type} | ì›ì¸: ${defect.cause}<br>
                            ì¡°ì¹˜: ${defect.action}
                        </div>
                    `;
                    historyDiv.appendChild(item);
                });
                
                Utils.showElement('defectHistorySection');
            }
        }
        
        // ìƒì„¸ ë¶ˆëŸ‰ ì €ì¥
        function saveDetailedDefect() {
            var qty = parseFloat(Utils.getElementValue('analysisDefectQty'));
            var location = Utils.getElementValue('defectLocation');
            var immediateAction = Utils.getElementValue('immediateAction');
            var preventionPlan = Utils.getElementValue('preventionPlan');
            var actionOwner = Utils.getElementValue('actionOwner');
            var actionDeadline = Utils.getElementValue('actionDeadline');
            
            if (!qty || qty <= 0) {
                Utils.showAlert('ë¶ˆëŸ‰ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!selectedDefectType) {
                Utils.showAlert('ë¶ˆëŸ‰ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!selectedCause) {
                Utils.showAlert('ë¶ˆëŸ‰ ì›ì¸ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!immediateAction.trim()) {
                Utils.showAlert('ì¦‰ì‹œ ì¡°ì¹˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            // ìƒì„¸ ë¶ˆëŸ‰ ê¸°ë¡ ìƒì„±
            var detailedDefect = {
                id: Date.now(),
                time: new Date(),
                qty: qty,
                location: location,
                type: selectedDefectType,
                typeText: DEFECT_TYPES[selectedDefectType] || selectedDefectType,
                cause: selectedCause,
                immediateAction: immediateAction,
                preventionPlan: preventionPlan,
                actionOwner: actionOwner,
                actionDeadline: actionDeadline,
                // ì‘ì—… ì»¨í…ìŠ¤íŠ¸
                workContext: {
                    workNo: selectedWork ? selectedWork.name : null,
                    product: selectedWork ? selectedWork.product : null,
                    customer: selectedWork ? selectedWork.customer : null,
                    lotNumber: currentLotNumber,
                    moldNumber: currentMoldNumber,
                    workers: Utils.getWorkersInfo().all,
                    workStartTime: workStartTime,
                    workElapsed: workStartTime ? Math.floor((new Date() - workStartTime) / 1000 / 60) : 0,
                    currentProgress: selectedWork ? selectedWork.actualQty : 0
                },
                status: 'active',
                reportedBy: currentWorker,
                machine: currentMachine
            };
            
            detailedDefectRecords.push(detailedDefect);
            
            // ì¼ë°˜ ë¶ˆëŸ‰ ê¸°ë¡ì—ë„ ì¶”ê°€
            var simpleDefect = {
                time: Utils.formatTime(new Date()),
                qty: qty,
                type: selectedDefectType,
                typeText: DEFECT_TYPES[selectedDefectType] || selectedDefectType,
                workers: Utils.getWorkersInfo().all,
                machine: currentMachine,
                isDetailed: true,
                detailId: detailedDefect.id
            };
            
            defectRecords.push(simpleDefect);
            
            // ê´€ë¦¬ì ì•Œë¦¼ (ì‹¤ì œë¡œëŠ” Firebase/ì„œë²„ë¡œ ì „ì†¡)
            var alertMessage = `ğŸš¨ ìƒì„¸ ë¶ˆëŸ‰ ë¶„ì„ ì™„ë£Œ\n` +
                             `í˜¸ê¸°: ${currentMachine}í˜¸ê¸°\n` +
                             `ì‘ì—…: ${detailedDefect.workContext.workNo || 'ë¯¸ì§€ì •'}\n` +
                             `ë¶ˆëŸ‰: ${qty}m (${detailedDefect.typeText})\n` +
                             `ì›ì¸: ${selectedCause}\n` +
                             `ì¡°ì¹˜: ${immediateAction}`;
            
            console.log('ê´€ë¦¬ì ì•Œë¦¼:', alertMessage);
            
            // ì‹¤ì‹œê°„ í† ìŠ¤íŠ¸ ì•Œë¦¼
            showToast('error', 'ë¶ˆëŸ‰ ì‹ ê³  ì™„ë£Œ', 
                `${qty}m ${detailedDefect.typeText} ë¶ˆëŸ‰ì´ ê´€ë¦¬ìì—ê²Œ ì‹ ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            // ì—°ì† ë¶ˆëŸ‰ ì²´í¬
            checkConsecutiveDefects();
            
            // UI ì—…ë°ì´íŠ¸
            updateDefectList();
            updateKPI();
            
            Utils.hideModal('defectAnalysisModal');
            
            Utils.showAlert('ìƒì„¸ ë¶ˆëŸ‰ ë¶„ì„ì´ ì™„ë£Œë˜ì–´ ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì¶”ì  ID: ' + detailedDefect.id);
        }
        
        // ì—°ì† ë¶ˆëŸ‰ ì²´í¬
        function checkConsecutiveDefects() {
            var recentDefects = defectRecords.filter(function(d) {
                var defectTime = new Date(d.time);
                var now = new Date();
                var timeDiff = (now - defectTime) / 1000 / 60; // ë¶„ ë‹¨ìœ„
                return timeDiff <= CONFIG.DEFECT_CONSECUTIVE_TIME_MINUTES;
            });
            
            if (recentDefects.length >= CONFIG.DEFECT_CONSECUTIVE_COUNT_THRESHOLD) {
                showToast('error', 'ì—°ì† ë¶ˆëŸ‰ ê²½ê³ ', 
                    '30ë¶„ ë‚´ 3ê±´ ì´ìƒ ë¶ˆëŸ‰ ë°œìƒ! ì¦‰ì‹œ ì‘ì—… ì¤‘ë‹¨ ê¶Œê³ ');
                
                // ì‘ì—… ì¤‘ë‹¨ ê¶Œê³  ì•Œë¦¼
                if (Utils.confirm('ğŸš¨ ì—°ì† ë¶ˆëŸ‰ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì‘ì—…ì„ ì¼ì‹œ ì¤‘ë‹¨í•˜ê³  ê´€ë¦¬ìì—ê²Œ ë³´ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // ì‘ì—… ì¼ì‹œ ì •ì§€ ë¡œì§
                    console.log('ì—°ì† ë¶ˆëŸ‰ìœ¼ë¡œ ì¸í•œ ì‘ì—… ì¤‘ë‹¨ ìš”ì²­');
                }
            }
        }
        
        // ë¶ˆëŸ‰ ë¶„ì„ ëª¨ë‹¬ ë‹«ê¸°
        function closeDefectAnalysisModal() {
            Utils.hideModal('defectAnalysisModal');
        }
        
        // ë¶ˆëŸ‰ ìƒì„¸ ì •ë³´ ë³´ê¸°
        function showDefectDetail(detailId) {
            var detailedRecord = detailedDefectRecords.find(function(d) { return d.id === detailId; });
            if (!detailedRecord) return;
            
            var detailInfo = `
ğŸ” ë¶ˆëŸ‰ ìƒì„¸ ë¶„ì„ ê²°ê³¼

ğŸ“‹ ê¸°ë³¸ ì •ë³´:
- ì¶”ì  ID: ${detailedRecord.id}
- ë°œìƒ ì‹œê°„: ${Utils.formatDateTime(detailedRecord.time)}
- ë¶ˆëŸ‰ ìˆ˜ëŸ‰: ${detailedRecord.qty}m
- ë°œê²¬ ìœ„ì¹˜: ${detailedRecord.location || '-'}
- ë¶ˆëŸ‰ ìœ í˜•: ${detailedRecord.typeText}

ğŸ”§ ì‘ì—… ì»¨í…ìŠ¤íŠ¸:
- ì‘ì—…ì§€ì‹œì„œ: ${detailedRecord.workContext.workNo || '-'}
- ì œí’ˆëª…: ${detailedRecord.workContext.product || '-'}
- LOT ë²ˆí˜¸: ${detailedRecord.workContext.lotNumber || '-'}
- ê¸ˆí˜• ë²ˆí˜¸: ${detailedRecord.workContext.moldNumber || '-'}
- ì‘ì—…ì: ${detailedRecord.workContext.workers.join(', ')}
- ì‘ì—… ê²½ê³¼: ${detailedRecord.workContext.workElapsed}ë¶„

ğŸ¯ ì›ì¸ ë¶„ì„:
- ì›ì¸: ${detailedRecord.cause}

âš¡ ì¡°ì¹˜ ì‚¬í•­:
- ì¦‰ì‹œ ì¡°ì¹˜: ${detailedRecord.immediateAction}
- ì¬ë°œ ë°©ì§€: ${detailedRecord.preventionPlan || '-'}
- ë‹´ë‹¹ì: ${detailedRecord.actionOwner}
- ì™„ë£Œ ì˜ˆì •: ${detailedRecord.actionDeadline || '-'}

ğŸ“Š ìƒíƒœ: ${detailedRecord.status === 'active' ? 'ì§„í–‰ì¤‘' : 'ì™„ë£Œ'}
ì‹ ê³ ì: ${detailedRecord.reportedBy} (${detailedRecord.machine}í˜¸ê¸°)
            `;
            
            Utils.showAlert(detailInfo);
        }
    </script>
</body>
</html>
